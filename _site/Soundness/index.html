<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Soundness: of reduction with respect to denotational semantics | Programming Language Foundations in Agda
</title><!-- Begin Jekyll SEO tag v2.5.0 -->
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Soundness: of reduction with respect to denotational semantics" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Programming Language Foundations in Agda" />
<meta property="og:description" content="Programming Language Foundations in Agda" />
<link rel="canonical" href="https://plfa.github.io/Soundness/" />
<meta property="og:url" content="https://plfa.github.io/Soundness/" />
<meta property="og:site_name" content="Programming Language Foundations in Agda" />
<script type="application/ld+json">
{"description":"Programming Language Foundations in Agda","@type":"WebPage","url":"https://plfa.github.io/Soundness/","headline":"Soundness: of reduction with respect to denotational semantics","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"></head>
<body><header class="site-header" role="banner">

    <div class="wrapper">

        <a class="site-title" href="/">Programming Language Foundations in Agda
</a>

        <nav class="site-nav">
            <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
                </svg>
            </span>

            <div class="trigger">
                <a class="page-link" href="/">Table of Contents</a>
                <a class="page-link" href="/GettingStarted/">Getting Started</a>
            </div>
        </nav>

    </div>

</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
      <h1 class="post-title">Soundness: of reduction with respect to denotational semantics</h1>
  </header>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/Compositional/">Prev</a>
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/Soundness.lagda">Source</a>
    
    
    &bullet;
    <a alt="Next chapter" href="/Adequacy/">Next</a>
    
</p>


  <div class="post-content">
    <pre class="Agda"><a id="192" class="Keyword">module</a> <a id="199" href="/Soundness/" class="Module">plfa.Soundness</a> <a id="214" class="Keyword">where</a></pre>

<h2 id="imports">Imports</h2>

<pre class="Agda"><a id="257" class="Keyword">open</a> <a id="262" class="Keyword">import</a> <a id="269" href="/Untyped/" class="Module">plfa.Untyped</a>
<a id="282" class="Keyword">open</a> <a id="287" class="Keyword">import</a> <a id="294" href="/Denotational/" class="Module">plfa.Denotational</a>
<a id="312" class="Keyword">open</a> <a id="317" class="Keyword">import</a> <a id="324" href="/Compositional/" class="Module">plfa.Compositional</a>

<a id="344" class="Keyword">open</a> <a id="349" class="Keyword">import</a> <a id="356" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a>
  <a id="396" class="Keyword">using</a> <a id="402" class="Symbol">(</a><a id="403" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">_≡_</a><a id="406" class="Symbol">;</a> <a id="408" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#660" class="Function Operator">_≢_</a><a id="411" class="Symbol">;</a> <a id="413" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="417" class="Symbol">;</a> <a id="419" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a><a id="422" class="Symbol">;</a> <a id="424" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.html#1170" class="Function">cong</a><a id="428" class="Symbol">;</a> <a id="430" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.html#1408" class="Function">cong₂</a><a id="435" class="Symbol">;</a> <a id="437" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.html#1274" class="Function">cong-app</a><a id="445" class="Symbol">)</a>
<a id="447" class="Keyword">open</a> <a id="452" class="Keyword">import</a> <a id="459" href="https://agda.github.io/agda-stdlib/Data.Product.html" class="Module">Data.Product</a> <a id="472" class="Keyword">using</a> <a id="478" class="Symbol">(</a><a id="479" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">_×_</a><a id="482" class="Symbol">;</a> <a id="484" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#69" class="Record">Σ</a><a id="485" class="Symbol">;</a> <a id="487" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ-syntax</a><a id="495" class="Symbol">;</a> <a id="497" href="https://agda.github.io/agda-stdlib/Data.Product.html#881" class="Function">∃</a><a id="498" class="Symbol">;</a> <a id="500" href="https://agda.github.io/agda-stdlib/Data.Product.html#942" class="Function">∃-syntax</a><a id="508" class="Symbol">;</a> <a id="510" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#155" class="Field">proj₁</a><a id="515" class="Symbol">;</a> <a id="517" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#167" class="Field">proj₂</a><a id="522" class="Symbol">)</a>
  <a id="526" class="Keyword">renaming</a> <a id="535" class="Symbol">(</a><a id="536" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">_,_</a> <a id="540" class="Symbol">to</a> <a id="543" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨_,_⟩</a><a id="548" class="Symbol">)</a>
<a id="550" class="Keyword">open</a> <a id="555" class="Keyword">import</a> <a id="562" href="https://agda.github.io/agda-stdlib/Data.Sum.html" class="Module">Data.Sum</a>
<a id="571" class="Keyword">open</a> <a id="576" class="Keyword">import</a> <a id="583" href="https://agda.github.io/agda-stdlib/Agda.Primitive.html" class="Module">Agda.Primitive</a> <a id="598" class="Keyword">using</a> <a id="604" class="Symbol">(</a><a id="605" href="https://agda.github.io/agda-stdlib/Agda.Primitive.html#611" class="Primitive">lzero</a><a id="610" class="Symbol">)</a>
<a id="612" class="Keyword">open</a> <a id="617" class="Keyword">import</a> <a id="624" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="641" class="Keyword">using</a> <a id="647" class="Symbol">(</a><a id="648" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#464" class="Function Operator">¬_</a><a id="650" class="Symbol">)</a>
<a id="652" class="Keyword">open</a> <a id="657" class="Keyword">import</a> <a id="664" href="https://agda.github.io/agda-stdlib/Relation.Nullary.Negation.html" class="Module">Relation.Nullary.Negation</a> <a id="690" class="Keyword">using</a> <a id="696" class="Symbol">(</a><a id="697" href="https://agda.github.io/agda-stdlib/Relation.Nullary.Negation.html#560" class="Function">contradiction</a><a id="710" class="Symbol">)</a>
<a id="712" class="Keyword">open</a> <a id="717" class="Keyword">import</a> <a id="724" href="https://agda.github.io/agda-stdlib/Data.Empty.html" class="Module">Data.Empty</a> <a id="735" class="Keyword">using</a> <a id="741" class="Symbol">(</a><a id="742" href="https://agda.github.io/agda-stdlib/Data.Empty.html#360" class="Function">⊥-elim</a><a id="748" class="Symbol">)</a>
<a id="750" class="Keyword">open</a> <a id="755" class="Keyword">import</a> <a id="762" href="https://agda.github.io/agda-stdlib/Data.Unit.html" class="Module">Data.Unit</a>
<a id="772" class="Keyword">open</a> <a id="777" class="Keyword">import</a> <a id="784" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="801" class="Keyword">using</a> <a id="807" class="Symbol">(</a><a id="808" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#534" class="Datatype">Dec</a><a id="811" class="Symbol">;</a> <a id="813" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a><a id="816" class="Symbol">;</a> <a id="818" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a><a id="820" class="Symbol">)</a>
<a id="822" class="Keyword">open</a> <a id="827" class="Keyword">import</a> <a id="834" href="https://agda.github.io/agda-stdlib/Function.html" class="Module">Function</a> <a id="843" class="Keyword">using</a> <a id="849" class="Symbol">(</a><a id="850" href="https://agda.github.io/agda-stdlib/Function.html#769" class="Function Operator">_∘_</a><a id="853" class="Symbol">)</a>
<a id="855" class="Comment">-- open import plfa.Isomorphism using (extensionality)  -- causes a bug!</a></pre>

<p>In this chapter we prove that the reduction semantics is sound with
respect to the denotational semantics, i.e., for any term L</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>L —↠ ƛ N  implies  ℰ L ≃ ℰ (ƛ N)
</code></pre></div></div>

<p>The proof is by induction on the reduction sequence, so the main lemma
concerns a single reduction step. We prove that if any term <code class="highlighter-rouge">M</code> steps
to a term <code class="highlighter-rouge">N</code>, then <code class="highlighter-rouge">M</code> and <code class="highlighter-rouge">N</code> are denotationally equal. We shall
prove each direction of this if-and-only-if separately. One direction
will look just like a type preservation proof. The other direction is
like proving type preservation for reduction going in reverse.  Recall
that type preservation is sometimes called subject
reduction. Preservation in reverse is a well-known property and is
called <em>subject expansion</em>. It is also well-known that subject
expansion is false for most typed lambda calculi!</p>

<h2 id="forward-reduction-preserves-denotations">Forward reduction preserves denotations</h2>

<p>The proof of preservation in this section mixes techniques from
previous chapters. Like the proof of preservation for the STLC, we are
preserving a relation defined separately from the syntax, in contrast
to the inherently typed terms. On the other hand, we are using de
Bruijn indices for variables.</p>

<p>The outline of the proof remains the same in that we must prove lemmas
concerning all of the auxiliary functions used in the reduction
relation: substitution, renaming, and extension.</p>

<h3 id="simultaneous-substitution-preserves-denotations">Simultaneous substitution preserves denotations</h3>

<p>We introduce the following shorthand for the type of a substitution
from variables in context <code class="highlighter-rouge">Γ</code> to terms in context <code class="highlighter-rouge">Δ</code>.</p>

<pre class="Agda"><a id="Subst"></a><a id="2482" href="/Soundness/#2482" class="Function">Subst</a> <a id="2488" class="Symbol">:</a> <a id="2490" href="/Untyped/#2980" class="Datatype">Context</a> <a id="2498" class="Symbol">→</a> <a id="2500" href="/Untyped/#2980" class="Datatype">Context</a> <a id="2508" class="Symbol">→</a> <a id="2510" class="PrimitiveType">Set</a>
<a id="2514" href="/Soundness/#2482" class="Function">Subst</a> <a id="2520" href="/Soundness/#2520" class="Bound">Γ</a> <a id="2522" href="/Soundness/#2522" class="Bound">Δ</a> <a id="2524" class="Symbol">=</a> <a id="2526" class="Symbol">∀{</a><a id="2528" href="/Soundness/#2528" class="Bound">A</a><a id="2529" class="Symbol">}</a> <a id="2531" class="Symbol">→</a> <a id="2533" href="/Soundness/#2520" class="Bound">Γ</a> <a id="2535" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="2537" href="/Soundness/#2528" class="Bound">A</a> <a id="2539" class="Symbol">→</a> <a id="2541" href="/Soundness/#2522" class="Bound">Δ</a> <a id="2543" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="2545" href="/Soundness/#2528" class="Bound">A</a></pre>

<p>Our next goal is to prove that simultaneous substitution preserves
meaning.  That is, if <code class="highlighter-rouge">M</code> results in <code class="highlighter-rouge">v</code> in environment <code class="highlighter-rouge">γ</code>, then applying a
substitution <code class="highlighter-rouge">σ</code> to <code class="highlighter-rouge">M</code> gives us a program that also results in <code class="highlighter-rouge">v</code>, but in
an environment <code class="highlighter-rouge">δ</code> in which, for every variable <code class="highlighter-rouge">x</code>, <code class="highlighter-rouge">σ x</code> results in the
same value as the one for <code class="highlighter-rouge">x</code> in the original environment <code class="highlighter-rouge">γ</code>.
We write <code class="highlighter-rouge">δ ⊢ σ ↓ γ</code> for this condition.</p>

<pre class="Agda"><a id="2971" class="Keyword">infix</a> <a id="2977" class="Number">3</a> <a id="2979" href="/Soundness/#2986" class="Function Operator">_`⊢_↓_</a>
<a id="_`⊢_↓_"></a><a id="2986" href="/Soundness/#2986" class="Function Operator">_`⊢_↓_</a> <a id="2993" class="Symbol">:</a> <a id="2995" class="Symbol">∀{</a><a id="2997" href="/Soundness/#2997" class="Bound">Δ</a> <a id="2999" href="/Soundness/#2999" class="Bound">Γ</a><a id="3000" class="Symbol">}</a> <a id="3002" class="Symbol">→</a> <a id="3004" href="/Denotational/#7331" class="Function">Env</a> <a id="3008" href="/Soundness/#2997" class="Bound">Δ</a> <a id="3010" class="Symbol">→</a> <a id="3012" href="/Soundness/#2482" class="Function">Subst</a> <a id="3018" href="/Soundness/#2999" class="Bound">Γ</a> <a id="3020" href="/Soundness/#2997" class="Bound">Δ</a> <a id="3022" class="Symbol">→</a> <a id="3024" href="/Denotational/#7331" class="Function">Env</a> <a id="3028" href="/Soundness/#2999" class="Bound">Γ</a> <a id="3030" class="Symbol">→</a> <a id="3032" class="PrimitiveType">Set</a>
<a id="3036" href="/Soundness/#2986" class="Function Operator">_`⊢_↓_</a> <a id="3043" class="Symbol">{</a><a id="3044" href="/Soundness/#3044" class="Bound">Δ</a><a id="3045" class="Symbol">}{</a><a id="3047" href="/Soundness/#3047" class="Bound">Γ</a><a id="3048" class="Symbol">}</a> <a id="3050" href="/Soundness/#3050" class="Bound">δ</a> <a id="3052" href="/Soundness/#3052" class="Bound">σ</a> <a id="3054" href="/Soundness/#3054" class="Bound">γ</a> <a id="3056" class="Symbol">=</a> <a id="3058" class="Symbol">(∀</a> <a id="3061" class="Symbol">(</a><a id="3062" href="/Soundness/#3062" class="Bound">x</a> <a id="3064" class="Symbol">:</a> <a id="3066" href="/Soundness/#3047" class="Bound">Γ</a> <a id="3068" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="3070" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="3071" class="Symbol">)</a> <a id="3073" class="Symbol">→</a> <a id="3075" href="/Soundness/#3050" class="Bound">δ</a> <a id="3077" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="3079" href="/Soundness/#3052" class="Bound">σ</a> <a id="3081" href="/Soundness/#3062" class="Bound">x</a> <a id="3083" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="3085" href="/Soundness/#3054" class="Bound">γ</a> <a id="3087" href="/Soundness/#3062" class="Bound">x</a><a id="3088" class="Symbol">)</a></pre>

<p>As usual, to prepare for lambda abstraction, we prove an extension
lemma. It says that applying the <code class="highlighter-rouge">exts</code> function to a substitution
produces a new substitution that maps variables to terms that when
evaluated in <code class="highlighter-rouge">δ , v</code> produce the values in <code class="highlighter-rouge">γ , v</code>.</p>

<pre class="Agda"><a id="subst-ext"></a><a id="3369" href="/Soundness/#3369" class="Function">subst-ext</a> <a id="3379" class="Symbol">:</a> <a id="3381" class="Symbol">∀</a> <a id="3383" class="Symbol">{</a><a id="3384" href="/Soundness/#3384" class="Bound">Γ</a> <a id="3386" href="/Soundness/#3386" class="Bound">Δ</a> <a id="3388" href="/Soundness/#3388" class="Bound">v</a><a id="3389" class="Symbol">}</a> <a id="3391" class="Symbol">{</a><a id="3392" href="/Soundness/#3392" class="Bound">γ</a> <a id="3394" class="Symbol">:</a> <a id="3396" href="/Denotational/#7331" class="Function">Env</a> <a id="3400" href="/Soundness/#3384" class="Bound">Γ</a><a id="3401" class="Symbol">}</a> <a id="3403" class="Symbol">{</a><a id="3404" href="/Soundness/#3404" class="Bound">δ</a> <a id="3406" class="Symbol">:</a> <a id="3408" href="/Denotational/#7331" class="Function">Env</a> <a id="3412" href="/Soundness/#3386" class="Bound">Δ</a><a id="3413" class="Symbol">}</a>
  <a id="3417" class="Symbol">→</a> <a id="3419" class="Symbol">(</a><a id="3420" href="/Soundness/#3420" class="Bound">σ</a> <a id="3422" class="Symbol">:</a> <a id="3424" href="/Soundness/#2482" class="Function">Subst</a> <a id="3430" href="/Soundness/#3384" class="Bound">Γ</a> <a id="3432" href="/Soundness/#3386" class="Bound">Δ</a><a id="3433" class="Symbol">)</a>
  <a id="3437" class="Symbol">→</a> <a id="3439" href="/Soundness/#3404" class="Bound">δ</a> <a id="3441" href="/Soundness/#2986" class="Function Operator">`⊢</a> <a id="3444" href="/Soundness/#3420" class="Bound">σ</a> <a id="3446" href="/Soundness/#2986" class="Function Operator">↓</a> <a id="3448" href="/Soundness/#3392" class="Bound">γ</a>
   <a id="3453" class="Comment">--------------------------</a>
  <a id="3482" class="Symbol">→</a> <a id="3484" href="/Soundness/#3404" class="Bound">δ</a> <a id="3486" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="3489" href="/Soundness/#3388" class="Bound">v</a> <a id="3491" href="/Soundness/#2986" class="Function Operator">`⊢</a> <a id="3494" href="/Untyped/#6623" class="Function">exts</a> <a id="3499" href="/Soundness/#3420" class="Bound">σ</a> <a id="3501" href="/Soundness/#2986" class="Function Operator">↓</a> <a id="3503" href="/Soundness/#3392" class="Bound">γ</a> <a id="3505" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="3508" href="/Soundness/#3388" class="Bound">v</a>
<a id="3510" href="/Soundness/#3369" class="Function">subst-ext</a> <a id="3520" href="/Soundness/#3520" class="Bound">σ</a> <a id="3522" href="/Soundness/#3522" class="Bound">d</a> <a id="3524" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="3526" class="Symbol">=</a> <a id="3528" href="/Denotational/#9925" class="InductiveConstructor">var</a>
<a id="3532" href="/Soundness/#3369" class="Function">subst-ext</a> <a id="3542" href="/Soundness/#3542" class="Bound">σ</a> <a id="3544" href="/Soundness/#3544" class="Bound">d</a> <a id="3546" class="Symbol">(</a><a id="3547" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="3549" href="/Soundness/#3549" class="Bound">x</a><a id="3550" class="Symbol">)</a> <a id="3552" class="Symbol">=</a> <a id="3554" href="/Denotational/#24146" class="Function">rename-pres</a> <a id="3566" href="/Untyped/#3446" class="InductiveConstructor Operator">S_</a> <a id="3569" class="Symbol">(λ</a> <a id="3572" href="/Soundness/#3572" class="Bound">_</a> <a id="3574" class="Symbol">→</a> <a id="3576" href="/Denotational/#5638" class="Function">Refl⊑</a><a id="3581" class="Symbol">)</a> <a id="3583" class="Symbol">(</a><a id="3584" href="/Soundness/#3544" class="Bound">d</a> <a id="3586" href="/Soundness/#3549" class="Bound">x</a><a id="3587" class="Symbol">)</a></pre>

<p>The proof is by cases on the de Bruijn index <code class="highlighter-rouge">x</code>.</p>

<ul>
  <li>
    <p>If it is <code class="highlighter-rouge">Z</code>, then we need to show that <code class="highlighter-rouge">δ , v ⊢ # 0 ↓ v</code>,
which we have by rule <code class="highlighter-rouge">var</code>.</p>
  </li>
  <li>
    <p>If it is <code class="highlighter-rouge">S x'</code>,then we need to show that 
<code class="highlighter-rouge">δ , v ⊢ rename S_ (σ x') ↓ nth x' γ</code>,
which we obtain by the <code class="highlighter-rouge">rename-pres</code> lemma.</p>
  </li>
</ul>

<p>With the extension lemma in hand, the proof that simultaneous
substitution preserves meaning is straightforward.  Let’s dive in!</p>

<pre class="Agda"><a id="subst-pres"></a><a id="4021" href="/Soundness/#4021" class="Function">subst-pres</a> <a id="4032" class="Symbol">:</a> <a id="4034" class="Symbol">∀</a> <a id="4036" class="Symbol">{</a><a id="4037" href="/Soundness/#4037" class="Bound">Γ</a> <a id="4039" href="/Soundness/#4039" class="Bound">Δ</a> <a id="4041" href="/Soundness/#4041" class="Bound">v</a><a id="4042" class="Symbol">}</a> <a id="4044" class="Symbol">{</a><a id="4045" href="/Soundness/#4045" class="Bound">γ</a> <a id="4047" class="Symbol">:</a> <a id="4049" href="/Denotational/#7331" class="Function">Env</a> <a id="4053" href="/Soundness/#4037" class="Bound">Γ</a><a id="4054" class="Symbol">}</a> <a id="4056" class="Symbol">{</a><a id="4057" href="/Soundness/#4057" class="Bound">δ</a> <a id="4059" class="Symbol">:</a> <a id="4061" href="/Denotational/#7331" class="Function">Env</a> <a id="4065" href="/Soundness/#4039" class="Bound">Δ</a><a id="4066" class="Symbol">}</a> <a id="4068" class="Symbol">{</a><a id="4069" href="/Soundness/#4069" class="Bound">M</a> <a id="4071" class="Symbol">:</a> <a id="4073" href="/Soundness/#4037" class="Bound">Γ</a> <a id="4075" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="4077" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="4078" class="Symbol">}</a>
  <a id="4082" class="Symbol">→</a> <a id="4084" class="Symbol">(</a><a id="4085" href="/Soundness/#4085" class="Bound">σ</a> <a id="4087" class="Symbol">:</a> <a id="4089" href="/Soundness/#2482" class="Function">Subst</a> <a id="4095" href="/Soundness/#4037" class="Bound">Γ</a> <a id="4097" href="/Soundness/#4039" class="Bound">Δ</a><a id="4098" class="Symbol">)</a>
  <a id="4102" class="Symbol">→</a> <a id="4104" href="/Soundness/#4057" class="Bound">δ</a> <a id="4106" href="/Soundness/#2986" class="Function Operator">`⊢</a> <a id="4109" href="/Soundness/#4085" class="Bound">σ</a> <a id="4111" href="/Soundness/#2986" class="Function Operator">↓</a> <a id="4113" href="/Soundness/#4045" class="Bound">γ</a>
  <a id="4117" class="Symbol">→</a> <a id="4119" href="/Soundness/#4045" class="Bound">γ</a> <a id="4121" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="4123" href="/Soundness/#4069" class="Bound">M</a> <a id="4125" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="4127" href="/Soundness/#4041" class="Bound">v</a>
    <a id="4133" class="Comment">------------------</a>
  <a id="4154" class="Symbol">→</a> <a id="4156" href="/Soundness/#4057" class="Bound">δ</a> <a id="4158" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="4160" href="/Untyped/#6931" class="Function">subst</a> <a id="4166" href="/Soundness/#4085" class="Bound">σ</a> <a id="4168" href="/Soundness/#4069" class="Bound">M</a> <a id="4170" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="4172" href="/Soundness/#4041" class="Bound">v</a>
<a id="4174" href="/Soundness/#4021" class="Function">subst-pres</a> <a id="4185" href="/Soundness/#4185" class="Bound">σ</a> <a id="4187" href="/Soundness/#4187" class="Bound">s</a> <a id="4189" class="Symbol">(</a><a id="4190" href="/Denotational/#9925" class="InductiveConstructor">var</a> <a id="4194" class="Symbol">{</a><a id="4195" class="Argument">x</a> <a id="4197" class="Symbol">=</a> <a id="4199" href="/Soundness/#4199" class="Bound">x</a><a id="4200" class="Symbol">})</a> <a id="4203" class="Symbol">=</a> <a id="4205" class="Symbol">(</a><a id="4206" href="/Soundness/#4187" class="Bound">s</a> <a id="4208" href="/Soundness/#4199" class="Bound">x</a><a id="4209" class="Symbol">)</a>
<a id="4211" href="/Soundness/#4021" class="Function">subst-pres</a> <a id="4222" href="/Soundness/#4222" class="Bound">σ</a> <a id="4224" href="/Soundness/#4224" class="Bound">s</a> <a id="4226" class="Symbol">(</a><a id="4227" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="4234" href="/Soundness/#4234" class="Bound">d₁</a> <a id="4237" href="/Soundness/#4237" class="Bound">d₂</a><a id="4239" class="Symbol">)</a> <a id="4241" class="Symbol">=</a>
  <a id="4245" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="4252" class="Symbol">(</a><a id="4253" href="/Soundness/#4021" class="Function">subst-pres</a> <a id="4264" href="/Soundness/#4222" class="Bound">σ</a> <a id="4266" href="/Soundness/#4224" class="Bound">s</a> <a id="4268" href="/Soundness/#4234" class="Bound">d₁</a><a id="4270" class="Symbol">)</a> <a id="4272" class="Symbol">(</a><a id="4273" href="/Soundness/#4021" class="Function">subst-pres</a> <a id="4284" href="/Soundness/#4222" class="Bound">σ</a> <a id="4286" href="/Soundness/#4224" class="Bound">s</a> <a id="4288" href="/Soundness/#4237" class="Bound">d₂</a><a id="4290" class="Symbol">)</a> 
<a id="4293" href="/Soundness/#4021" class="Function">subst-pres</a> <a id="4304" href="/Soundness/#4304" class="Bound">σ</a> <a id="4306" href="/Soundness/#4306" class="Bound">s</a> <a id="4308" class="Symbol">(</a><a id="4309" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="4317" href="/Soundness/#4317" class="Bound">d</a><a id="4318" class="Symbol">)</a> <a id="4320" class="Symbol">=</a>
  <a id="4324" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="4332" class="Symbol">(</a><a id="4333" href="/Soundness/#4021" class="Function">subst-pres</a> <a id="4344" class="Symbol">(λ</a> <a id="4347" class="Symbol">{</a><a id="4348" href="/Soundness/#4348" class="Bound">A</a><a id="4349" class="Symbol">}</a> <a id="4351" class="Symbol">→</a> <a id="4353" href="/Untyped/#6623" class="Function">exts</a> <a id="4358" href="/Soundness/#4304" class="Bound">σ</a><a id="4359" class="Symbol">)</a> <a id="4361" class="Symbol">(</a><a id="4362" href="/Soundness/#3369" class="Function">subst-ext</a> <a id="4372" href="/Soundness/#4304" class="Bound">σ</a> <a id="4374" href="/Soundness/#4306" class="Bound">s</a><a id="4375" class="Symbol">)</a> <a id="4377" href="/Soundness/#4317" class="Bound">d</a><a id="4378" class="Symbol">)</a>
<a id="4380" href="/Soundness/#4021" class="Function">subst-pres</a> <a id="4391" href="/Soundness/#4391" class="Bound">σ</a> <a id="4393" href="/Soundness/#4393" class="Bound">s</a> <a id="4395" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a> <a id="4403" class="Symbol">=</a> <a id="4405" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a>
<a id="4413" href="/Soundness/#4021" class="Function">subst-pres</a> <a id="4424" href="/Soundness/#4424" class="Bound">σ</a> <a id="4426" href="/Soundness/#4426" class="Bound">s</a> <a id="4428" class="Symbol">(</a><a id="4429" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="4437" href="/Soundness/#4437" class="Bound">d₁</a> <a id="4440" href="/Soundness/#4440" class="Bound">d₂</a><a id="4442" class="Symbol">)</a> <a id="4444" class="Symbol">=</a>
  <a id="4448" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="4456" class="Symbol">(</a><a id="4457" href="/Soundness/#4021" class="Function">subst-pres</a> <a id="4468" href="/Soundness/#4424" class="Bound">σ</a> <a id="4470" href="/Soundness/#4426" class="Bound">s</a> <a id="4472" href="/Soundness/#4437" class="Bound">d₁</a><a id="4474" class="Symbol">)</a> <a id="4476" class="Symbol">(</a><a id="4477" href="/Soundness/#4021" class="Function">subst-pres</a> <a id="4488" href="/Soundness/#4424" class="Bound">σ</a> <a id="4490" href="/Soundness/#4426" class="Bound">s</a> <a id="4492" href="/Soundness/#4440" class="Bound">d₂</a><a id="4494" class="Symbol">)</a>
<a id="4496" href="/Soundness/#4021" class="Function">subst-pres</a> <a id="4507" href="/Soundness/#4507" class="Bound">σ</a> <a id="4509" href="/Soundness/#4509" class="Bound">s</a> <a id="4511" class="Symbol">(</a><a id="4512" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="4516" href="/Soundness/#4516" class="Bound">d</a> <a id="4518" href="/Soundness/#4518" class="Bound">lt</a><a id="4520" class="Symbol">)</a> <a id="4522" class="Symbol">=</a> <a id="4524" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="4528" class="Symbol">(</a><a id="4529" href="/Soundness/#4021" class="Function">subst-pres</a> <a id="4540" href="/Soundness/#4507" class="Bound">σ</a> <a id="4542" href="/Soundness/#4509" class="Bound">s</a> <a id="4544" href="/Soundness/#4516" class="Bound">d</a><a id="4545" class="Symbol">)</a> <a id="4547" href="/Soundness/#4518" class="Bound">lt</a></pre>

<p>The proof is by induction on the semantics of <code class="highlighter-rouge">M</code>.  The two interesting
cases are for variables and lambda abstractions.</p>

<ul>
  <li>
    <p>For a variable <code class="highlighter-rouge">x</code>, we have that <code class="highlighter-rouge">v ⊑ nth x γ</code> and we need to show that
<code class="highlighter-rouge">δ ⊢ σ x ↓ v</code>.  From the premise applied to <code class="highlighter-rouge">x</code>, we have that
<code class="highlighter-rouge">δ ⊢ σ x ↓ nth x γ</code>, so we conclude by the <code class="highlighter-rouge">sub</code> rule.</p>
  </li>
  <li>
    <p>For a lambda abstraction, we must extend the substitution
for the induction hypothesis. We apply the <code class="highlighter-rouge">subst-ext</code> lemma
to show that the extended substitution maps variables to
terms that result in the appropriate values.</p>
  </li>
</ul>

<h3 id="single-substitution-preserves-denotations">Single substitution preserves denotations</h3>

<p>For β reduction, <code class="highlighter-rouge">(ƛ N) · M —→ N [ M ]</code>, we need to show that the
semantics is preserved when substituting <code class="highlighter-rouge">M</code> for de Bruijn index 0 in
term <code class="highlighter-rouge">N</code>. By inversion on the rules <code class="highlighter-rouge">↦-elim</code> and <code class="highlighter-rouge">↦-intro</code>,
we have that <code class="highlighter-rouge">γ , v ⊢ M ↓ w</code> and <code class="highlighter-rouge">γ ⊢ N ↓ v</code>.
So we need to show that <code class="highlighter-rouge">γ ⊢ M [ N ] ↓ w</code>, or equivalently,
that <code class="highlighter-rouge">γ ⊢ subst (subst-zero N) M ↓ w</code>.</p>

<pre class="Agda"><a id="substitution"></a><a id="5513" href="/Soundness/#5513" class="Function">substitution</a> <a id="5526" class="Symbol">:</a> <a id="5528" class="Symbol">∀</a> <a id="5530" class="Symbol">{</a><a id="5531" href="/Soundness/#5531" class="Bound">Γ</a><a id="5532" class="Symbol">}</a> <a id="5534" class="Symbol">{</a><a id="5535" href="/Soundness/#5535" class="Bound">γ</a> <a id="5537" class="Symbol">:</a> <a id="5539" href="/Denotational/#7331" class="Function">Env</a> <a id="5543" href="/Soundness/#5531" class="Bound">Γ</a><a id="5544" class="Symbol">}</a> <a id="5546" class="Symbol">{</a><a id="5547" href="/Soundness/#5547" class="Bound">N</a> <a id="5549" href="/Soundness/#5549" class="Bound">M</a> <a id="5551" href="/Soundness/#5551" class="Bound">v</a> <a id="5553" href="/Soundness/#5553" class="Bound">w</a><a id="5554" class="Symbol">}</a>
   <a id="5559" class="Symbol">→</a> <a id="5561" href="/Soundness/#5535" class="Bound">γ</a> <a id="5563" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="5566" href="/Soundness/#5551" class="Bound">v</a> <a id="5568" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="5570" href="/Soundness/#5547" class="Bound">N</a> <a id="5572" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="5574" href="/Soundness/#5553" class="Bound">w</a>
   <a id="5579" class="Symbol">→</a> <a id="5581" href="/Soundness/#5535" class="Bound">γ</a> <a id="5583" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="5585" href="/Soundness/#5549" class="Bound">M</a> <a id="5587" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="5589" href="/Soundness/#5551" class="Bound">v</a>
     <a id="5596" class="Comment">---------------</a>
   <a id="5615" class="Symbol">→</a> <a id="5617" href="/Soundness/#5535" class="Bound">γ</a> <a id="5619" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="5621" href="/Soundness/#5547" class="Bound">N</a> <a id="5623" href="/Untyped/#7475" class="Function Operator">[</a> <a id="5625" href="/Soundness/#5549" class="Bound">M</a> <a id="5627" href="/Untyped/#7475" class="Function Operator">]</a> <a id="5629" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="5631" href="/Soundness/#5553" class="Bound">w</a>   
<a id="5636" href="/Soundness/#5513" class="Function">substitution</a><a id="5648" class="Symbol">{</a><a id="5649" href="/Soundness/#5649" class="Bound">Γ</a><a id="5650" class="Symbol">}{</a><a id="5652" href="/Soundness/#5652" class="Bound">γ</a><a id="5653" class="Symbol">}{</a><a id="5655" href="/Soundness/#5655" class="Bound">N</a><a id="5656" class="Symbol">}{</a><a id="5658" href="/Soundness/#5658" class="Bound">M</a><a id="5659" class="Symbol">}{</a><a id="5661" href="/Soundness/#5661" class="Bound">v</a><a id="5662" class="Symbol">}{</a><a id="5664" href="/Soundness/#5664" class="Bound">w</a><a id="5665" class="Symbol">}</a> <a id="5667" href="/Soundness/#5667" class="Bound">dn</a> <a id="5670" href="/Soundness/#5670" class="Bound">dm</a> <a id="5673" class="Symbol">=</a>
  <a id="5677" href="/Soundness/#4021" class="Function">subst-pres</a> <a id="5688" class="Symbol">(</a><a id="5689" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="5700" href="/Soundness/#5658" class="Bound">M</a><a id="5701" class="Symbol">)</a> <a id="5703" href="/Soundness/#5725" class="Function">sub-z-ok</a> <a id="5712" href="/Soundness/#5667" class="Bound">dn</a>
  <a id="5717" class="Keyword">where</a>
  <a id="5725" href="/Soundness/#5725" class="Function">sub-z-ok</a> <a id="5734" class="Symbol">:</a> <a id="5736" href="/Soundness/#5652" class="Bound">γ</a> <a id="5738" href="/Soundness/#2986" class="Function Operator">`⊢</a> <a id="5741" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="5752" href="/Soundness/#5658" class="Bound">M</a> <a id="5754" href="/Soundness/#2986" class="Function Operator">↓</a> <a id="5756" class="Symbol">(</a><a id="5757" href="/Soundness/#5652" class="Bound">γ</a> <a id="5759" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="5762" href="/Soundness/#5661" class="Bound">v</a><a id="5763" class="Symbol">)</a>
  <a id="5767" href="/Soundness/#5725" class="Function">sub-z-ok</a> <a id="5776" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="5778" class="Symbol">=</a> <a id="5780" href="/Soundness/#5670" class="Bound">dm</a>
  <a id="5785" href="/Soundness/#5725" class="Function">sub-z-ok</a> <a id="5794" class="Symbol">(</a><a id="5795" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="5797" href="/Soundness/#5797" class="Bound">x</a><a id="5798" class="Symbol">)</a> <a id="5800" class="Symbol">=</a> <a id="5802" href="/Denotational/#9925" class="InductiveConstructor">var</a></pre>

<p>This result is a corollary of the lemma for simultaneous substitution.
To use the lemma, we just need to show that <code class="highlighter-rouge">subst-zero M</code> maps
variables to terms that produces the same values as those in <code class="highlighter-rouge">γ , v</code>.
Let <code class="highlighter-rouge">y</code> be an arbitrary variable (de Bruijn index).</p>

<ul>
  <li>
    <p>If it is <code class="highlighter-rouge">Z</code>, then <code class="highlighter-rouge">(subst-zero M) y = M</code> and <code class="highlighter-rouge">nth y (γ , v) = v</code>.
By the premise we conclude that <code class="highlighter-rouge">γ ⊢ M ↓ v</code>.</p>
  </li>
  <li>
    <p>If it is <code class="highlighter-rouge">S x</code>, then <code class="highlighter-rouge">(subst-zero M) (S x) = x</code> and
<code class="highlighter-rouge">nth (S x) (γ , v) = nth x γ</code>.  So we conclude that
<code class="highlighter-rouge">γ ⊢ x ↓ nth x γ</code> by rule <code class="highlighter-rouge">var</code>.</p>
  </li>
</ul>

<h3 id="reduction-preserves-denotations">Reduction preserves denotations</h3>

<p>With the substitution lemma in hand, it is straightforward to prove
that reduction preserves denotations.</p>

<pre class="Agda"><a id="preserve"></a><a id="6495" href="/Soundness/#6495" class="Function">preserve</a> <a id="6504" class="Symbol">:</a> <a id="6506" class="Symbol">∀</a> <a id="6508" class="Symbol">{</a><a id="6509" href="/Soundness/#6509" class="Bound">Γ</a><a id="6510" class="Symbol">}</a> <a id="6512" class="Symbol">{</a><a id="6513" href="/Soundness/#6513" class="Bound">γ</a> <a id="6515" class="Symbol">:</a> <a id="6517" href="/Denotational/#7331" class="Function">Env</a> <a id="6521" href="/Soundness/#6509" class="Bound">Γ</a><a id="6522" class="Symbol">}</a> <a id="6524" class="Symbol">{</a><a id="6525" href="/Soundness/#6525" class="Bound">M</a> <a id="6527" href="/Soundness/#6527" class="Bound">N</a> <a id="6529" href="/Soundness/#6529" class="Bound">v</a><a id="6530" class="Symbol">}</a>
  <a id="6534" class="Symbol">→</a> <a id="6536" href="/Soundness/#6513" class="Bound">γ</a> <a id="6538" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="6540" href="/Soundness/#6525" class="Bound">M</a> <a id="6542" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="6544" href="/Soundness/#6529" class="Bound">v</a>
  <a id="6548" class="Symbol">→</a> <a id="6550" href="/Soundness/#6525" class="Bound">M</a> <a id="6552" href="/Untyped/#10070" class="Datatype Operator">—→</a> <a id="6555" href="/Soundness/#6527" class="Bound">N</a>
    <a id="6561" class="Comment">----------</a>
  <a id="6574" class="Symbol">→</a> <a id="6576" href="/Soundness/#6513" class="Bound">γ</a> <a id="6578" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="6580" href="/Soundness/#6527" class="Bound">N</a> <a id="6582" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="6584" href="/Soundness/#6529" class="Bound">v</a>
<a id="6586" href="/Soundness/#6495" class="Function">preserve</a> <a id="6595" class="Symbol">(</a><a id="6596" href="/Denotational/#9925" class="InductiveConstructor">var</a><a id="6599" class="Symbol">)</a> <a id="6601" class="Symbol">()</a>
<a id="6604" href="/Soundness/#6495" class="Function">preserve</a> <a id="6613" class="Symbol">(</a><a id="6614" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="6621" href="/Soundness/#6621" class="Bound">d₁</a> <a id="6624" href="/Soundness/#6624" class="Bound">d₂</a><a id="6626" class="Symbol">)</a> <a id="6628" class="Symbol">(</a><a id="6629" href="/Untyped/#10120" class="InductiveConstructor">ξ₁</a> <a id="6632" href="/Soundness/#6632" class="Bound">x</a> <a id="6634" href="/Soundness/#6634" class="Bound">r</a><a id="6635" class="Symbol">)</a> <a id="6637" class="Symbol">=</a> <a id="6639" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="6646" class="Symbol">(</a><a id="6647" href="/Soundness/#6495" class="Function">preserve</a> <a id="6656" href="/Soundness/#6621" class="Bound">d₁</a> <a id="6659" href="/Soundness/#6634" class="Bound">r</a><a id="6660" class="Symbol">)</a> <a id="6662" href="/Soundness/#6624" class="Bound">d₂</a> 
<a id="6666" href="/Soundness/#6495" class="Function">preserve</a> <a id="6675" class="Symbol">(</a><a id="6676" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="6683" href="/Soundness/#6683" class="Bound">d₁</a> <a id="6686" href="/Soundness/#6686" class="Bound">d₂</a><a id="6688" class="Symbol">)</a> <a id="6690" class="Symbol">(</a><a id="6691" href="/Untyped/#10230" class="InductiveConstructor">ξ₂</a> <a id="6694" href="/Soundness/#6694" class="Bound">x</a> <a id="6696" href="/Soundness/#6696" class="Bound">r</a><a id="6697" class="Symbol">)</a> <a id="6699" class="Symbol">=</a> <a id="6701" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="6708" href="/Soundness/#6683" class="Bound">d₁</a> <a id="6711" class="Symbol">(</a><a id="6712" href="/Soundness/#6495" class="Function">preserve</a> <a id="6721" href="/Soundness/#6686" class="Bound">d₂</a> <a id="6724" href="/Soundness/#6696" class="Bound">r</a><a id="6725" class="Symbol">)</a> 
<a id="6728" href="/Soundness/#6495" class="Function">preserve</a> <a id="6737" class="Symbol">(</a><a id="6738" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="6745" href="/Soundness/#6745" class="Bound">d₁</a> <a id="6748" href="/Soundness/#6748" class="Bound">d₂</a><a id="6750" class="Symbol">)</a> <a id="6752" href="/Untyped/#10336" class="InductiveConstructor">β</a> <a id="6754" class="Symbol">=</a> <a id="6756" href="/Soundness/#5513" class="Function">substitution</a> <a id="6769" class="Symbol">(</a><a id="6770" href="/Compositional/#2952" class="Function">lambda-inversion</a> <a id="6787" href="/Soundness/#6745" class="Bound">d₁</a><a id="6789" class="Symbol">)</a> <a id="6791" href="/Soundness/#6748" class="Bound">d₂</a>
<a id="6794" href="/Soundness/#6495" class="Function">preserve</a> <a id="6803" class="Symbol">(</a><a id="6804" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="6812" href="/Soundness/#6812" class="Bound">d</a><a id="6813" class="Symbol">)</a> <a id="6815" class="Symbol">(</a><a id="6816" href="/Untyped/#10444" class="InductiveConstructor">ζ</a> <a id="6818" href="/Soundness/#6818" class="Bound">r</a><a id="6819" class="Symbol">)</a> <a id="6821" class="Symbol">=</a> <a id="6823" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="6831" class="Symbol">(</a><a id="6832" href="/Soundness/#6495" class="Function">preserve</a> <a id="6841" href="/Soundness/#6812" class="Bound">d</a> <a id="6843" href="/Soundness/#6818" class="Bound">r</a><a id="6844" class="Symbol">)</a>
<a id="6846" href="/Soundness/#6495" class="Function">preserve</a> <a id="6855" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a> <a id="6863" href="/Soundness/#6863" class="Bound">r</a> <a id="6865" class="Symbol">=</a> <a id="6867" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a>
<a id="6875" href="/Soundness/#6495" class="Function">preserve</a> <a id="6884" class="Symbol">(</a><a id="6885" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="6893" href="/Soundness/#6893" class="Bound">d</a> <a id="6895" href="/Soundness/#6895" class="Bound">d₁</a><a id="6897" class="Symbol">)</a> <a id="6899" href="/Soundness/#6899" class="Bound">r</a> <a id="6901" class="Symbol">=</a> <a id="6903" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="6911" class="Symbol">(</a><a id="6912" href="/Soundness/#6495" class="Function">preserve</a> <a id="6921" href="/Soundness/#6893" class="Bound">d</a> <a id="6923" href="/Soundness/#6899" class="Bound">r</a><a id="6924" class="Symbol">)</a> <a id="6926" class="Symbol">(</a><a id="6927" href="/Soundness/#6495" class="Function">preserve</a> <a id="6936" href="/Soundness/#6895" class="Bound">d₁</a> <a id="6939" href="/Soundness/#6899" class="Bound">r</a><a id="6940" class="Symbol">)</a>
<a id="6942" href="/Soundness/#6495" class="Function">preserve</a> <a id="6951" class="Symbol">(</a><a id="6952" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="6956" href="/Soundness/#6956" class="Bound">d</a> <a id="6958" href="/Soundness/#6958" class="Bound">lt</a><a id="6960" class="Symbol">)</a> <a id="6962" href="/Soundness/#6962" class="Bound">r</a> <a id="6964" class="Symbol">=</a> <a id="6966" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="6970" class="Symbol">(</a><a id="6971" href="/Soundness/#6495" class="Function">preserve</a> <a id="6980" href="/Soundness/#6956" class="Bound">d</a> <a id="6982" href="/Soundness/#6962" class="Bound">r</a><a id="6983" class="Symbol">)</a> <a id="6985" href="/Soundness/#6958" class="Bound">lt</a></pre>

<p>We proceed by induction on the semantics of <code class="highlighter-rouge">M</code> with case analysis on
the reduction.</p>

<ul>
  <li>
    <p>If <code class="highlighter-rouge">M</code> is a variable, then there is no such reduction.</p>
  </li>
  <li>
    <p>If <code class="highlighter-rouge">M</code> is an application, then the reduction is either a congruence
(ξ₁ or ξ₂) or β. For each congruence, we use the induction
hypothesis. For β reduction we use the substitution lemma and the
<code class="highlighter-rouge">sub</code> rule.</p>
  </li>
  <li>
    <p>The rest of the cases are straightforward.</p>
  </li>
</ul>

<h2 id="reduction-reflects-denotations">Reduction reflects denotations</h2>

<p>This section proves that reduction reflects the denotation of a
term. That is, if <code class="highlighter-rouge">N</code> results in <code class="highlighter-rouge">v</code>, and if <code class="highlighter-rouge">M</code> reduces to <code class="highlighter-rouge">N</code>, then
<code class="highlighter-rouge">M</code> also results in <code class="highlighter-rouge">v</code>. While there are some broad similarities
between this proof and the above proof of semantic preservation, we
shall require a few more technical lemmas to obtain this result.</p>

<p>The main challenge is dealing with the substitution in β reduction:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ƛ N) · M —→ N [ M ]
</code></pre></div></div>

<p>We have that <code class="highlighter-rouge">γ ⊢ N [ M ] ↓ v</code> and need to show that
<code class="highlighter-rouge">γ ⊢ (ƛ N) · M ↓ v</code>. Now consider the derivation of <code class="highlighter-rouge">γ ⊢ N [ M ] ↓ v</code>.
The term <code class="highlighter-rouge">M</code> may occur 0, 1, or many times inside <code class="highlighter-rouge">N [ M ]</code>. At each of
those occurences, <code class="highlighter-rouge">M</code> may result in a different value. But to build a
derivation for <code class="highlighter-rouge">(ƛ N) · M</code>, we need a single value for <code class="highlighter-rouge">M</code>.  If <code class="highlighter-rouge">M</code>
occured more than 1 time, then we can join all of the different values
using <code class="highlighter-rouge">⊔</code>. If <code class="highlighter-rouge">M</code> occured 0 times, then we do not need any information
about <code class="highlighter-rouge">M</code> and can therefore use <code class="highlighter-rouge">⊥</code> for the value of <code class="highlighter-rouge">M</code>.</p>

<h3 id="renaming-reflects-meaning">Renaming reflects meaning</h3>

<p>Previously we showed that renaming variables preserves meaning.  Now
we prove the opposite, that it reflects meaning. That is,
if <code class="highlighter-rouge">δ ⊢ rename ρ M ↓ v</code>, then <code class="highlighter-rouge">γ ⊢ M ↓ v</code>, where <code class="highlighter-rouge">(δ ∘ ρ) </code>⊑ γ`.</p>

<p>First, we need a variant of a lemma given earlier.</p>
<pre class="Agda"><a id="nth-ext"></a><a id="8691" href="/Soundness/#8691" class="Function">nth-ext</a> <a id="8699" class="Symbol">:</a> <a id="8701" class="Symbol">∀</a> <a id="8703" class="Symbol">{</a><a id="8704" href="/Soundness/#8704" class="Bound">Γ</a> <a id="8706" href="/Soundness/#8706" class="Bound">Δ</a> <a id="8708" href="/Soundness/#8708" class="Bound">v</a><a id="8709" class="Symbol">}</a> <a id="8711" class="Symbol">{</a><a id="8712" href="/Soundness/#8712" class="Bound">γ</a> <a id="8714" class="Symbol">:</a> <a id="8716" href="/Denotational/#7331" class="Function">Env</a> <a id="8720" href="/Soundness/#8704" class="Bound">Γ</a><a id="8721" class="Symbol">}</a> <a id="8723" class="Symbol">{</a><a id="8724" href="/Soundness/#8724" class="Bound">δ</a> <a id="8726" class="Symbol">:</a> <a id="8728" href="/Denotational/#7331" class="Function">Env</a> <a id="8732" href="/Soundness/#8706" class="Bound">Δ</a><a id="8733" class="Symbol">}</a>
  <a id="8737" class="Symbol">→</a> <a id="8739" class="Symbol">(</a><a id="8740" href="/Soundness/#8740" class="Bound">ρ</a> <a id="8742" class="Symbol">:</a> <a id="8744" href="/Denotational/#23286" class="Function">Rename</a> <a id="8751" href="/Soundness/#8704" class="Bound">Γ</a> <a id="8753" href="/Soundness/#8706" class="Bound">Δ</a><a id="8754" class="Symbol">)</a>
  <a id="8758" class="Symbol">→</a> <a id="8760" class="Symbol">(</a><a id="8761" href="/Soundness/#8724" class="Bound">δ</a> <a id="8763" href="https://agda.github.io/agda-stdlib/Function.html#769" class="Function Operator">∘</a> <a id="8765" href="/Soundness/#8740" class="Bound">ρ</a><a id="8766" class="Symbol">)</a> <a id="8768" href="/Denotational/#8357" class="Function Operator">`⊑</a> <a id="8771" href="/Soundness/#8712" class="Bound">γ</a>
    <a id="8777" class="Comment">------------------------------</a>
  <a id="8810" class="Symbol">→</a> <a id="8812" class="Symbol">((</a><a id="8814" href="/Soundness/#8724" class="Bound">δ</a> <a id="8816" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="8819" href="/Soundness/#8708" class="Bound">v</a><a id="8820" class="Symbol">)</a> <a id="8822" href="https://agda.github.io/agda-stdlib/Function.html#769" class="Function Operator">∘</a> <a id="8824" href="/Untyped/#5845" class="Function">ext</a> <a id="8828" href="/Soundness/#8740" class="Bound">ρ</a><a id="8829" class="Symbol">)</a> <a id="8831" href="/Denotational/#8357" class="Function Operator">`⊑</a> <a id="8834" class="Symbol">(</a><a id="8835" href="/Soundness/#8712" class="Bound">γ</a> <a id="8837" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="8840" href="/Soundness/#8708" class="Bound">v</a><a id="8841" class="Symbol">)</a>
<a id="8843" href="/Soundness/#8691" class="Function">nth-ext</a> <a id="8851" href="/Soundness/#8851" class="Bound">ρ</a> <a id="8853" href="/Soundness/#8853" class="Bound">lt</a> <a id="8856" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="8858" class="Symbol">=</a> <a id="8860" href="/Denotational/#5638" class="Function">Refl⊑</a>
<a id="8866" href="/Soundness/#8691" class="Function">nth-ext</a> <a id="8874" href="/Soundness/#8874" class="Bound">ρ</a> <a id="8876" href="/Soundness/#8876" class="Bound">lt</a> <a id="8879" class="Symbol">(</a><a id="8880" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="8882" href="/Soundness/#8882" class="Bound">x</a><a id="8883" class="Symbol">)</a> <a id="8885" class="Symbol">=</a> <a id="8887" href="/Soundness/#8876" class="Bound">lt</a> <a id="8890" href="/Soundness/#8882" class="Bound">x</a></pre>

<p>The proof is then as follows.</p>
<pre class="Agda"><a id="rename-reflect"></a><a id="8947" href="/Soundness/#8947" class="Function">rename-reflect</a> <a id="8962" class="Symbol">:</a> <a id="8964" class="Symbol">∀</a> <a id="8966" class="Symbol">{</a><a id="8967" href="/Soundness/#8967" class="Bound">Γ</a> <a id="8969" href="/Soundness/#8969" class="Bound">Δ</a> <a id="8971" href="/Soundness/#8971" class="Bound">v</a><a id="8972" class="Symbol">}</a> <a id="8974" class="Symbol">{</a><a id="8975" href="/Soundness/#8975" class="Bound">γ</a> <a id="8977" class="Symbol">:</a> <a id="8979" href="/Denotational/#7331" class="Function">Env</a> <a id="8983" href="/Soundness/#8967" class="Bound">Γ</a><a id="8984" class="Symbol">}</a> <a id="8986" class="Symbol">{</a><a id="8987" href="/Soundness/#8987" class="Bound">δ</a> <a id="8989" class="Symbol">:</a> <a id="8991" href="/Denotational/#7331" class="Function">Env</a> <a id="8995" href="/Soundness/#8969" class="Bound">Δ</a><a id="8996" class="Symbol">}</a> <a id="8998" class="Symbol">{</a> <a id="9000" href="/Soundness/#9000" class="Bound">M</a> <a id="9002" class="Symbol">:</a> <a id="9004" href="/Soundness/#8967" class="Bound">Γ</a> <a id="9006" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="9008" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="9009" class="Symbol">}</a>
  <a id="9013" class="Symbol">→</a> <a id="9015" class="Symbol">{</a><a id="9016" href="/Soundness/#9016" class="Bound">ρ</a> <a id="9018" class="Symbol">:</a> <a id="9020" href="/Denotational/#23286" class="Function">Rename</a> <a id="9027" href="/Soundness/#8967" class="Bound">Γ</a> <a id="9029" href="/Soundness/#8969" class="Bound">Δ</a><a id="9030" class="Symbol">}</a>
  <a id="9034" class="Symbol">→</a> <a id="9036" class="Symbol">(</a><a id="9037" href="/Soundness/#8987" class="Bound">δ</a> <a id="9039" href="https://agda.github.io/agda-stdlib/Function.html#769" class="Function Operator">∘</a> <a id="9041" href="/Soundness/#9016" class="Bound">ρ</a><a id="9042" class="Symbol">)</a> <a id="9044" href="/Denotational/#8357" class="Function Operator">`⊑</a> <a id="9047" href="/Soundness/#8975" class="Bound">γ</a>
  <a id="9051" class="Symbol">→</a> <a id="9053" href="/Soundness/#8987" class="Bound">δ</a> <a id="9055" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="9057" href="/Untyped/#6171" class="Function">rename</a> <a id="9064" href="/Soundness/#9016" class="Bound">ρ</a> <a id="9066" href="/Soundness/#9000" class="Bound">M</a> <a id="9068" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="9070" href="/Soundness/#8971" class="Bound">v</a>
    <a id="9076" class="Comment">------------------------------------</a>
  <a id="9115" class="Symbol">→</a> <a id="9117" href="/Soundness/#8975" class="Bound">γ</a> <a id="9119" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="9121" href="/Soundness/#9000" class="Bound">M</a> <a id="9123" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="9125" href="/Soundness/#8971" class="Bound">v</a>
<a id="9127" href="/Soundness/#8947" class="Function">rename-reflect</a> <a id="9142" class="Symbol">{</a><a id="9143" class="Argument">M</a> <a id="9145" class="Symbol">=</a> <a id="9147" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="9149" href="/Soundness/#9149" class="Bound">x</a><a id="9150" class="Symbol">}</a> <a id="9152" href="/Soundness/#9152" class="Bound">all-n</a> <a id="9158" href="/Soundness/#9158" class="Bound">d</a> <a id="9160" class="Keyword">with</a> <a id="9165" href="/Compositional/#9007" class="Function">var-inv</a> <a id="9173" href="/Soundness/#9158" class="Bound">d</a>
<a id="9175" class="Symbol">...</a> <a id="9179" class="Symbol">|</a> <a id="9181" href="/Soundness/#9181" class="Bound">lt</a> <a id="9184" class="Symbol">=</a>  <a id="9187" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="9191" href="/Denotational/#9925" class="InductiveConstructor">var</a> <a id="9195" class="Symbol">(</a><a id="9196" href="/Denotational/#4765" class="InductiveConstructor">Trans⊑</a> <a id="9203" href="/Soundness/#9181" class="Bound">lt</a> <a id="9206" class="Symbol">(</a><a id="9207" class="Bound">all-n</a> <a id="9213" class="Bound">x</a><a id="9214" class="Symbol">))</a>
<a id="9217" href="/Soundness/#8947" class="Function">rename-reflect</a> <a id="9232" class="Symbol">{</a><a id="9233" class="Argument">M</a> <a id="9235" class="Symbol">=</a> <a id="9237" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9239" href="/Soundness/#9239" class="Bound">N</a><a id="9240" class="Symbol">}{</a><a id="9242" class="Argument">ρ</a> <a id="9244" class="Symbol">=</a> <a id="9246" href="/Soundness/#9246" class="Bound">ρ</a><a id="9247" class="Symbol">}</a> <a id="9249" href="/Soundness/#9249" class="Bound">all-n</a> <a id="9255" class="Symbol">(</a><a id="9256" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="9264" href="/Soundness/#9264" class="Bound">d</a><a id="9265" class="Symbol">)</a> <a id="9267" class="Symbol">=</a>
   <a id="9272" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="9280" class="Symbol">(</a><a id="9281" href="/Soundness/#8947" class="Function">rename-reflect</a> <a id="9296" class="Symbol">(</a><a id="9297" href="/Soundness/#8691" class="Function">nth-ext</a> <a id="9305" href="/Soundness/#9246" class="Bound">ρ</a> <a id="9307" href="/Soundness/#9249" class="Bound">all-n</a><a id="9312" class="Symbol">)</a> <a id="9314" href="/Soundness/#9264" class="Bound">d</a><a id="9315" class="Symbol">)</a>
<a id="9317" href="/Soundness/#8947" class="Function">rename-reflect</a> <a id="9332" class="Symbol">{</a><a id="9333" class="Argument">M</a> <a id="9335" class="Symbol">=</a> <a id="9337" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9339" href="/Soundness/#9339" class="Bound">N</a><a id="9340" class="Symbol">}</a> <a id="9342" href="/Soundness/#9342" class="Bound">all-n</a> <a id="9348" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a> <a id="9356" class="Symbol">=</a> <a id="9358" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a>
<a id="9366" href="/Soundness/#8947" class="Function">rename-reflect</a> <a id="9381" class="Symbol">{</a><a id="9382" class="Argument">M</a> <a id="9384" class="Symbol">=</a> <a id="9386" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9388" href="/Soundness/#9388" class="Bound">N</a><a id="9389" class="Symbol">}</a> <a id="9391" href="/Soundness/#9391" class="Bound">all-n</a> <a id="9397" class="Symbol">(</a><a id="9398" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="9406" href="/Soundness/#9406" class="Bound">d₁</a> <a id="9409" href="/Soundness/#9409" class="Bound">d₂</a><a id="9411" class="Symbol">)</a> <a id="9413" class="Symbol">=</a>
   <a id="9418" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="9426" class="Symbol">(</a><a id="9427" href="/Soundness/#8947" class="Function">rename-reflect</a> <a id="9442" href="/Soundness/#9391" class="Bound">all-n</a> <a id="9448" href="/Soundness/#9406" class="Bound">d₁</a><a id="9450" class="Symbol">)</a> <a id="9452" class="Symbol">(</a><a id="9453" href="/Soundness/#8947" class="Function">rename-reflect</a> <a id="9468" href="/Soundness/#9391" class="Bound">all-n</a> <a id="9474" href="/Soundness/#9409" class="Bound">d₂</a><a id="9476" class="Symbol">)</a>
<a id="9478" href="/Soundness/#8947" class="Function">rename-reflect</a> <a id="9493" class="Symbol">{</a><a id="9494" class="Argument">M</a> <a id="9496" class="Symbol">=</a> <a id="9498" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9500" href="/Soundness/#9500" class="Bound">N</a><a id="9501" class="Symbol">}</a> <a id="9503" href="/Soundness/#9503" class="Bound">all-n</a> <a id="9509" class="Symbol">(</a><a id="9510" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="9514" href="/Soundness/#9514" class="Bound">d₁</a> <a id="9517" href="/Soundness/#9517" class="Bound">lt</a><a id="9519" class="Symbol">)</a> <a id="9521" class="Symbol">=</a>
   <a id="9526" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="9530" class="Symbol">(</a><a id="9531" href="/Soundness/#8947" class="Function">rename-reflect</a> <a id="9546" href="/Soundness/#9503" class="Bound">all-n</a> <a id="9552" href="/Soundness/#9514" class="Bound">d₁</a><a id="9554" class="Symbol">)</a> <a id="9556" href="/Soundness/#9517" class="Bound">lt</a>
<a id="9559" href="/Soundness/#8947" class="Function">rename-reflect</a> <a id="9574" class="Symbol">{</a><a id="9575" class="Argument">M</a> <a id="9577" class="Symbol">=</a> <a id="9579" href="/Soundness/#9579" class="Bound">L</a> <a id="9581" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="9583" href="/Soundness/#9583" class="Bound">M</a><a id="9584" class="Symbol">}</a> <a id="9586" href="/Soundness/#9586" class="Bound">all-n</a> <a id="9592" class="Symbol">(</a><a id="9593" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="9600" href="/Soundness/#9600" class="Bound">d₁</a> <a id="9603" href="/Soundness/#9603" class="Bound">d₂</a><a id="9605" class="Symbol">)</a> <a id="9607" class="Symbol">=</a>
   <a id="9612" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="9619" class="Symbol">(</a><a id="9620" href="/Soundness/#8947" class="Function">rename-reflect</a> <a id="9635" href="/Soundness/#9586" class="Bound">all-n</a> <a id="9641" href="/Soundness/#9600" class="Bound">d₁</a><a id="9643" class="Symbol">)</a> <a id="9645" class="Symbol">(</a><a id="9646" href="/Soundness/#8947" class="Function">rename-reflect</a> <a id="9661" href="/Soundness/#9586" class="Bound">all-n</a> <a id="9667" href="/Soundness/#9603" class="Bound">d₂</a><a id="9669" class="Symbol">)</a> 
<a id="9672" href="/Soundness/#8947" class="Function">rename-reflect</a> <a id="9687" class="Symbol">{</a><a id="9688" class="Argument">M</a> <a id="9690" class="Symbol">=</a> <a id="9692" href="/Soundness/#9692" class="Bound">L</a> <a id="9694" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="9696" href="/Soundness/#9696" class="Bound">M</a><a id="9697" class="Symbol">}</a> <a id="9699" href="/Soundness/#9699" class="Bound">all-n</a> <a id="9705" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a> <a id="9713" class="Symbol">=</a> <a id="9715" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a>
<a id="9723" href="/Soundness/#8947" class="Function">rename-reflect</a> <a id="9738" class="Symbol">{</a><a id="9739" class="Argument">M</a> <a id="9741" class="Symbol">=</a> <a id="9743" href="/Soundness/#9743" class="Bound">L</a> <a id="9745" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="9747" href="/Soundness/#9747" class="Bound">M</a><a id="9748" class="Symbol">}</a> <a id="9750" href="/Soundness/#9750" class="Bound">all-n</a> <a id="9756" class="Symbol">(</a><a id="9757" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="9765" href="/Soundness/#9765" class="Bound">d₁</a> <a id="9768" href="/Soundness/#9768" class="Bound">d₂</a><a id="9770" class="Symbol">)</a> <a id="9772" class="Symbol">=</a>
   <a id="9777" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="9785" class="Symbol">(</a><a id="9786" href="/Soundness/#8947" class="Function">rename-reflect</a> <a id="9801" href="/Soundness/#9750" class="Bound">all-n</a> <a id="9807" href="/Soundness/#9765" class="Bound">d₁</a><a id="9809" class="Symbol">)</a> <a id="9811" class="Symbol">(</a><a id="9812" href="/Soundness/#8947" class="Function">rename-reflect</a> <a id="9827" href="/Soundness/#9750" class="Bound">all-n</a> <a id="9833" href="/Soundness/#9768" class="Bound">d₂</a><a id="9835" class="Symbol">)</a>
<a id="9837" href="/Soundness/#8947" class="Function">rename-reflect</a> <a id="9852" class="Symbol">{</a><a id="9853" class="Argument">M</a> <a id="9855" class="Symbol">=</a> <a id="9857" href="/Soundness/#9857" class="Bound">L</a> <a id="9859" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="9861" href="/Soundness/#9861" class="Bound">M</a><a id="9862" class="Symbol">}</a> <a id="9864" href="/Soundness/#9864" class="Bound">all-n</a> <a id="9870" class="Symbol">(</a><a id="9871" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="9875" href="/Soundness/#9875" class="Bound">d₁</a> <a id="9878" href="/Soundness/#9878" class="Bound">lt</a><a id="9880" class="Symbol">)</a> <a id="9882" class="Symbol">=</a>
   <a id="9887" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="9891" class="Symbol">(</a><a id="9892" href="/Soundness/#8947" class="Function">rename-reflect</a> <a id="9907" href="/Soundness/#9864" class="Bound">all-n</a> <a id="9913" href="/Soundness/#9875" class="Bound">d₁</a><a id="9915" class="Symbol">)</a> <a id="9917" href="/Soundness/#9878" class="Bound">lt</a></pre>

<p>We cannot prove this lemma by induction on the derivation of
<code class="highlighter-rouge">δ ⊢ rename ρ M ↓ v</code>, so instead we proceed by induction on <code class="highlighter-rouge">M</code>.</p>

<ul>
  <li>
    <p>If it is a variable, we apply the inversion lemma to obtain
that <code class="highlighter-rouge">v ⊑ nth (ρ x) δ</code>. Instantiating the premise to <code class="highlighter-rouge">x</code> we have
<code class="highlighter-rouge">nth (ρ x) δ = nth x γ</code>, so we conclude by the <code class="highlighter-rouge">var</code> rule.</p>
  </li>
  <li>
    <p>If it is a lambda abstraction <code class="highlighter-rouge">ƛ N</code>, we have
rename <code class="highlighter-rouge">ρ (ƛ N) = ƛ (rename (ext ρ) N)</code>.
We proceed by cases on <code class="highlighter-rouge">δ ⊢ ƛ (rename (ext ρ) N) ↓ v</code>.</p>

    <ul>
      <li>
        <p>Rule <code class="highlighter-rouge">↦-intro</code>: To satisfy the premise of the induction
hypothesis, we prove that the renaming can be extended to be a
mapping from <code class="highlighter-rouge">γ , v₁ to δ , v₁</code>.</p>
      </li>
      <li>
        <p>Rule <code class="highlighter-rouge">⊥-intro</code>: We simply apply <code class="highlighter-rouge">⊥-intro</code>.</p>
      </li>
      <li>
        <p>Rule <code class="highlighter-rouge">⊔-intro</code>: We apply the induction hypotheses and <code class="highlighter-rouge">⊔-intro</code>.</p>
      </li>
      <li>
        <p>Rule <code class="highlighter-rouge">sub</code>: We apply the induction hypothesis and <code class="highlighter-rouge">sub</code>.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>If it is an application <code class="highlighter-rouge">L · M</code>, we have
<code class="highlighter-rouge">rename ρ (L · M) = (rename ρ L) · (rename ρ M)</code>.
We proceed by cases on <code class="highlighter-rouge">δ ⊢ (rename ρ L) · (rename ρ M) ↓ v</code>
and all the cases are straightforward.</p>
  </li>
</ul>

<p>In the upcoming uses of <code class="highlighter-rouge">rename-reflect</code>, the renaming will always be
the increment function. So we prove a corollary for that special case.</p>

<pre class="Agda"><a id="rename-inc-reflect"></a><a id="11098" href="/Soundness/#11098" class="Function">rename-inc-reflect</a> <a id="11117" class="Symbol">:</a> <a id="11119" class="Symbol">∀</a> <a id="11121" class="Symbol">{</a><a id="11122" href="/Soundness/#11122" class="Bound">Γ</a> <a id="11124" href="/Soundness/#11124" class="Bound">v&#39;</a> <a id="11127" href="/Soundness/#11127" class="Bound">v</a><a id="11128" class="Symbol">}</a> <a id="11130" class="Symbol">{</a><a id="11131" href="/Soundness/#11131" class="Bound">γ</a> <a id="11133" class="Symbol">:</a> <a id="11135" href="/Denotational/#7331" class="Function">Env</a> <a id="11139" href="/Soundness/#11122" class="Bound">Γ</a><a id="11140" class="Symbol">}</a> <a id="11142" class="Symbol">{</a> <a id="11144" href="/Soundness/#11144" class="Bound">M</a> <a id="11146" class="Symbol">:</a> <a id="11148" href="/Soundness/#11122" class="Bound">Γ</a> <a id="11150" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="11152" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="11153" class="Symbol">}</a>
  <a id="11157" class="Symbol">→</a> <a id="11159" class="Symbol">(</a><a id="11160" href="/Soundness/#11131" class="Bound">γ</a> <a id="11162" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="11165" href="/Soundness/#11124" class="Bound">v&#39;</a><a id="11167" class="Symbol">)</a> <a id="11169" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="11171" href="/Untyped/#6171" class="Function">rename</a> <a id="11178" href="/Untyped/#3446" class="InductiveConstructor Operator">S_</a> <a id="11181" href="/Soundness/#11144" class="Bound">M</a> <a id="11183" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="11185" href="/Soundness/#11127" class="Bound">v</a>
    <a id="11191" class="Comment">----------------------------</a>
  <a id="11222" class="Symbol">→</a> <a id="11224" href="/Soundness/#11131" class="Bound">γ</a> <a id="11226" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="11228" href="/Soundness/#11144" class="Bound">M</a> <a id="11230" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="11232" href="/Soundness/#11127" class="Bound">v</a>
<a id="11234" href="/Soundness/#11098" class="Function">rename-inc-reflect</a> <a id="11253" href="/Soundness/#11253" class="Bound">d</a> <a id="11255" class="Symbol">=</a> <a id="11257" href="/Soundness/#8947" class="Function">rename-reflect</a> <a id="11272" href="/Denotational/#8875" class="Function">`Refl⊑</a> <a id="11279" href="/Soundness/#11253" class="Bound">d</a></pre>

<h3 id="substitution-reflects-denotations-the-variable-case">Substitution reflects denotations, the variable case</h3>

<p>We are almost ready to begin proving that simultaneous substitution
reflects denotations. That is, if <code class="highlighter-rouge">γ ⊢ (subst σ M) ↓ v</code>, then
<code class="highlighter-rouge">γ ⊢ σ k ↓ nth k δ</code> and <code class="highlighter-rouge">δ ⊢ M ↓ v</code> for any <code class="highlighter-rouge">k</code> and some <code class="highlighter-rouge">δ</code>.
We shall start with the case in which <code class="highlighter-rouge">M</code> is a variable <code class="highlighter-rouge">x</code>.
So instead the premise is <code class="highlighter-rouge">γ ⊢ σ x ↓ v</code> and we need to show that
<code class="highlighter-rouge">δ ⊢ x ↓ v</code> for some <code class="highlighter-rouge">δ</code>. The <code class="highlighter-rouge">δ</code> that we choose shall be the
environment that maps <code class="highlighter-rouge">x</code> to <code class="highlighter-rouge">v</code> and every other variable to <code class="highlighter-rouge">⊥</code>.</p>

<p>The nth element of the `⊥ environment is always ⊥.
[PLW: Probably can omit]</p>
<pre class="Agda"><a id="nth-`⊥"></a><a id="11888" href="/Soundness/#11888" class="Function">nth-`⊥</a> <a id="11895" class="Symbol">:</a> <a id="11897" class="Symbol">∀{</a><a id="11899" href="/Soundness/#11899" class="Bound">Γ</a><a id="11900" class="Symbol">}</a> <a id="11902" class="Symbol">{</a><a id="11903" href="/Soundness/#11903" class="Bound">x</a> <a id="11905" class="Symbol">:</a> <a id="11907" href="/Soundness/#11899" class="Bound">Γ</a> <a id="11909" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="11911" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="11912" class="Symbol">}</a> <a id="11914" class="Symbol">→</a> <a id="11916" href="/Denotational/#8576" class="Function">`⊥</a> <a id="11919" href="/Soundness/#11903" class="Bound">x</a> <a id="11921" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="11923" href="/Denotational/#4117" class="InductiveConstructor">⊥</a>
<a id="11925" href="/Soundness/#11888" class="Function">nth-`⊥</a> <a id="11932" class="Symbol">{</a><a id="11933" class="Argument">x</a> <a id="11935" class="Symbol">=</a> <a id="11937" href="/Untyped/#3401" class="InductiveConstructor">Z</a><a id="11938" class="Symbol">}</a> <a id="11940" class="Symbol">=</a> <a id="11942" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="11947" href="/Soundness/#11888" class="Function">nth-`⊥</a> <a id="11954" class="Symbol">{</a><a id="11955" href="/Soundness/#11955" class="Bound">Γ</a> <a id="11957" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="11959" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="11960" class="Symbol">}</a> <a id="11962" class="Symbol">{</a><a id="11963" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="11965" href="/Soundness/#11965" class="Bound">x</a><a id="11966" class="Symbol">}</a> <a id="11968" class="Symbol">=</a> <a id="11970" href="/Soundness/#11888" class="Function">nth-`⊥</a> <a id="11977" class="Symbol">{</a><a id="11978" href="/Soundness/#11955" class="Bound">Γ</a><a id="11979" class="Symbol">}</a> <a id="11981" class="Symbol">{</a><a id="11982" href="/Soundness/#11965" class="Bound">x</a><a id="11983" class="Symbol">}</a></pre>

<p>Next we define the environment that maps <code class="highlighter-rouge">x</code> to <code class="highlighter-rouge">v</code> and every other
variable to <code class="highlighter-rouge">⊥</code>, that is <code class="highlighter-rouge">const-env x v</code>.</p>

<pre class="Agda"><a id="12121" class="Comment">{-
inv-S : ∀ {Γ A B} {x y : Γ ∋ A}
  → _≡_ {_} {Γ , B ∋ A} (S x) (S y)
  → S x ≡ S y
    -------------------------------
  → x ≡ y
inv-S refl = refl
-}</a>

<a id="_var≟_"></a><a id="12274" href="/Soundness/#12274" class="Function Operator">_var≟_</a> <a id="12281" class="Symbol">:</a> <a id="12283" class="Symbol">∀</a> <a id="12285" class="Symbol">{</a><a id="12286" href="/Soundness/#12286" class="Bound">Γ</a><a id="12287" class="Symbol">}</a> <a id="12289" class="Symbol">→</a> <a id="12291" class="Symbol">(</a><a id="12292" href="/Soundness/#12292" class="Bound">x</a> <a id="12294" href="/Soundness/#12294" class="Bound">y</a> <a id="12296" class="Symbol">:</a> <a id="12298" href="/Soundness/#12286" class="Bound">Γ</a> <a id="12300" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12302" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12303" class="Symbol">)</a> <a id="12305" class="Symbol">→</a> <a id="12307" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#534" class="Datatype">Dec</a> <a id="12311" class="Symbol">(</a><a id="12312" href="/Soundness/#12292" class="Bound">x</a> <a id="12314" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="12316" href="/Soundness/#12294" class="Bound">y</a><a id="12317" class="Symbol">)</a>
<a id="12319" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="12321" href="/Soundness/#12274" class="Function Operator">var≟</a> <a id="12326" href="/Untyped/#3401" class="InductiveConstructor">Z</a>  <a id="12329" class="Symbol">=</a>  <a id="12332" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12336" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12341" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="12343" href="/Soundness/#12274" class="Function Operator">var≟</a> <a id="12348" class="Symbol">(</a><a id="12349" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12351" class="Symbol">_)</a>  <a id="12355" class="Symbol">=</a>  <a id="12358" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12361" class="Symbol">λ()</a>
<a id="12365" class="Symbol">(</a><a id="12366" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12368" class="Symbol">_)</a> <a id="12371" href="/Soundness/#12274" class="Function Operator">var≟</a> <a id="12376" href="/Untyped/#3401" class="InductiveConstructor">Z</a>  <a id="12379" class="Symbol">=</a>  <a id="12382" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12385" class="Symbol">λ()</a>
<a id="12389" class="Symbol">(</a><a id="12390" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12392" href="/Soundness/#12392" class="Bound">x</a><a id="12393" class="Symbol">)</a> <a id="12395" href="/Soundness/#12274" class="Function Operator">var≟</a> <a id="12400" class="Symbol">(</a><a id="12401" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12403" href="/Soundness/#12403" class="Bound">y</a><a id="12404" class="Symbol">)</a> <a id="12406" class="Keyword">with</a>  <a id="12412" href="/Soundness/#12392" class="Bound">x</a> <a id="12414" href="/Soundness/#12274" class="Function Operator">var≟</a> <a id="12419" href="/Soundness/#12403" class="Bound">y</a>
<a id="12421" class="Symbol">...</a>                 <a id="12441" class="Symbol">|</a>  <a id="12444" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12448" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="12453" class="Symbol">=</a>  <a id="12456" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12460" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12465" class="Symbol">...</a>                 <a id="12485" class="Symbol">|</a>  <a id="12488" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12491" href="/Soundness/#12491" class="Bound">neq</a>   <a id="12497" class="Symbol">=</a>  <a id="12500" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12503" class="Symbol">λ{</a><a id="12505" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="12510" class="Symbol">→</a> <a id="12512" href="/Soundness/#12491" class="Bound">neq</a> <a id="12516" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="12520" class="Symbol">}</a>

<a id="var≟-refl"></a><a id="12523" href="/Soundness/#12523" class="Function">var≟-refl</a> <a id="12533" class="Symbol">:</a> <a id="12535" class="Symbol">∀</a> <a id="12537" class="Symbol">{</a><a id="12538" href="/Soundness/#12538" class="Bound">Γ</a><a id="12539" class="Symbol">}</a> <a id="12541" class="Symbol">(</a><a id="12542" href="/Soundness/#12542" class="Bound">x</a> <a id="12544" class="Symbol">:</a> <a id="12546" href="/Soundness/#12538" class="Bound">Γ</a> <a id="12548" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12550" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12551" class="Symbol">)</a> <a id="12553" class="Symbol">→</a> <a id="12555" class="Symbol">(</a><a id="12556" href="/Soundness/#12542" class="Bound">x</a> <a id="12558" href="/Soundness/#12274" class="Function Operator">var≟</a> <a id="12563" href="/Soundness/#12542" class="Bound">x</a><a id="12564" class="Symbol">)</a> <a id="12566" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="12568" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12572" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12577" href="/Soundness/#12523" class="Function">var≟-refl</a> <a id="12587" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="12589" class="Symbol">=</a> <a id="12591" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12596" href="/Soundness/#12523" class="Function">var≟-refl</a> <a id="12606" class="Symbol">(</a><a id="12607" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12609" href="/Soundness/#12609" class="Bound">x</a><a id="12610" class="Symbol">)</a> <a id="12612" class="Keyword">rewrite</a> <a id="12620" href="/Soundness/#12523" class="Function">var≟-refl</a> <a id="12630" href="/Soundness/#12609" class="Bound">x</a> <a id="12632" class="Symbol">=</a> <a id="12634" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>

<a id="const-env"></a><a id="12640" href="/Soundness/#12640" class="Function">const-env</a> <a id="12650" class="Symbol">:</a> <a id="12652" class="Symbol">∀{</a><a id="12654" href="/Soundness/#12654" class="Bound">Γ</a><a id="12655" class="Symbol">}</a> <a id="12657" class="Symbol">→</a> <a id="12659" class="Symbol">(</a><a id="12660" href="/Soundness/#12660" class="Bound">x</a> <a id="12662" class="Symbol">:</a> <a id="12664" href="/Soundness/#12654" class="Bound">Γ</a> <a id="12666" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12668" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12669" class="Symbol">)</a> <a id="12671" class="Symbol">→</a> <a id="12673" href="/Denotational/#4097" class="Datatype">Value</a> <a id="12679" class="Symbol">→</a> <a id="12681" href="/Denotational/#7331" class="Function">Env</a> <a id="12685" href="/Soundness/#12654" class="Bound">Γ</a>
<a id="12687" href="/Soundness/#12640" class="Function">const-env</a> <a id="12697" href="/Soundness/#12697" class="Bound">x</a> <a id="12699" href="/Soundness/#12699" class="Bound">v</a> <a id="12701" href="/Soundness/#12701" class="Bound">y</a> <a id="12703" class="Keyword">with</a> <a id="12708" href="/Soundness/#12697" class="Bound">x</a> <a id="12710" href="/Soundness/#12274" class="Function Operator">var≟</a> <a id="12715" href="/Soundness/#12701" class="Bound">y</a>
<a id="12717" class="Symbol">...</a>             <a id="12733" class="Symbol">|</a> <a id="12735" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12739" class="Symbol">_</a>       <a id="12747" class="Symbol">=</a> <a id="12749" class="Bound">v</a>
<a id="12751" class="Symbol">...</a>             <a id="12767" class="Symbol">|</a> <a id="12769" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12772" class="Symbol">_</a>        <a id="12781" class="Symbol">=</a> <a id="12783" href="/Denotational/#4117" class="InductiveConstructor">⊥</a></pre>

<p>Of course, the nth element of <code class="highlighter-rouge">const-env n v</code> is the value <code class="highlighter-rouge">v</code>.</p>

<pre class="Agda"><a id="nth-const-env"></a><a id="12875" href="/Soundness/#12875" class="Function">nth-const-env</a> <a id="12889" class="Symbol">:</a> <a id="12891" class="Symbol">∀{</a><a id="12893" href="/Soundness/#12893" class="Bound">Γ</a><a id="12894" class="Symbol">}</a> <a id="12896" class="Symbol">{</a><a id="12897" href="/Soundness/#12897" class="Bound">x</a> <a id="12899" class="Symbol">:</a> <a id="12901" href="/Soundness/#12893" class="Bound">Γ</a> <a id="12903" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12905" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12906" class="Symbol">}</a> <a id="12908" class="Symbol">{</a><a id="12909" href="/Soundness/#12909" class="Bound">v</a><a id="12910" class="Symbol">}</a> <a id="12912" class="Symbol">→</a> <a id="12914" class="Symbol">(</a><a id="12915" href="/Soundness/#12640" class="Function">const-env</a> <a id="12925" href="/Soundness/#12897" class="Bound">x</a> <a id="12927" href="/Soundness/#12909" class="Bound">v</a><a id="12928" class="Symbol">)</a> <a id="12930" href="/Soundness/#12897" class="Bound">x</a> <a id="12932" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="12934" href="/Soundness/#12909" class="Bound">v</a>
<a id="12936" href="/Soundness/#12875" class="Function">nth-const-env</a> <a id="12950" class="Symbol">{</a><a id="12951" class="Argument">x</a> <a id="12953" class="Symbol">=</a> <a id="12955" href="/Soundness/#12955" class="Bound">x</a><a id="12956" class="Symbol">}</a> <a id="12958" class="Keyword">rewrite</a> <a id="12966" href="/Soundness/#12523" class="Function">var≟-refl</a> <a id="12976" href="/Soundness/#12955" class="Bound">x</a> <a id="12978" class="Symbol">=</a> <a id="12980" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a></pre>

<p>The nth element of <code class="highlighter-rouge">const-env n' v</code> is the value <code class="highlighter-rouge">⊥, so long as </code>n ≢ n’`.</p>

<pre class="Agda"><a id="diff-nth-const-env"></a><a id="13085" href="/Soundness/#13085" class="Function">diff-nth-const-env</a> <a id="13104" class="Symbol">:</a> <a id="13106" class="Symbol">∀{</a><a id="13108" href="/Soundness/#13108" class="Bound">Γ</a><a id="13109" class="Symbol">}</a> <a id="13111" class="Symbol">{</a><a id="13112" href="/Soundness/#13112" class="Bound">x</a> <a id="13114" href="/Soundness/#13114" class="Bound">y</a> <a id="13116" class="Symbol">:</a> <a id="13118" href="/Soundness/#13108" class="Bound">Γ</a> <a id="13120" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="13122" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="13123" class="Symbol">}</a> <a id="13125" class="Symbol">{</a><a id="13126" href="/Soundness/#13126" class="Bound">v</a><a id="13127" class="Symbol">}</a>
  <a id="13131" class="Symbol">→</a> <a id="13133" href="/Soundness/#13112" class="Bound">x</a> <a id="13135" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#660" class="Function Operator">≢</a> <a id="13137" href="/Soundness/#13114" class="Bound">y</a>
    <a id="13143" class="Comment">-------------------</a>
  <a id="13165" class="Symbol">→</a> <a id="13167" href="/Soundness/#12640" class="Function">const-env</a> <a id="13177" href="/Soundness/#13112" class="Bound">x</a> <a id="13179" href="/Soundness/#13126" class="Bound">v</a> <a id="13181" href="/Soundness/#13114" class="Bound">y</a> <a id="13183" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="13185" href="/Denotational/#4117" class="InductiveConstructor">⊥</a>
<a id="13187" href="/Soundness/#13085" class="Function">diff-nth-const-env</a> <a id="13206" class="Symbol">{</a><a id="13207" href="/Soundness/#13207" class="Bound">Γ</a><a id="13208" class="Symbol">}</a> <a id="13210" class="Symbol">{</a><a id="13211" href="/Soundness/#13211" class="Bound">x</a><a id="13212" class="Symbol">}</a> <a id="13214" class="Symbol">{</a><a id="13215" href="/Soundness/#13215" class="Bound">y</a><a id="13216" class="Symbol">}</a> <a id="13218" href="/Soundness/#13218" class="Bound">neq</a> <a id="13222" class="Keyword">with</a> <a id="13227" href="/Soundness/#13211" class="Bound">x</a> <a id="13229" href="/Soundness/#12274" class="Function Operator">var≟</a> <a id="13234" href="/Soundness/#13215" class="Bound">y</a>
<a id="13236" class="Symbol">...</a>  <a id="13241" class="Symbol">|</a> <a id="13243" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="13247" href="/Soundness/#13247" class="Bound">eq</a>  <a id="13251" class="Symbol">=</a>  <a id="13254" href="https://agda.github.io/agda-stdlib/Data.Empty.html#360" class="Function">⊥-elim</a> <a id="13261" class="Symbol">(</a><a id="13262" class="Bound">neq</a> <a id="13266" href="/Soundness/#13247" class="Bound">eq</a><a id="13268" class="Symbol">)</a>
<a id="13270" class="Symbol">...</a>  <a id="13275" class="Symbol">|</a> <a id="13277" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="13280" class="Symbol">_</a>    <a id="13285" class="Symbol">=</a>  <a id="13288" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a></pre>

<p>So we choose <code class="highlighter-rouge">const-env x v</code> for <code class="highlighter-rouge">δ</code> and obtain <code class="highlighter-rouge">δ ⊢ x ↓ v</code>
with the <code class="highlighter-rouge">var</code> rule.</p>

<p>It remains to prove that <code class="highlighter-rouge">γ ⊢ σ ↓ δ</code> and <code class="highlighter-rouge">δ ⊢ M ↓ v</code> for any <code class="highlighter-rouge">k</code>, given that
we have chosen <code class="highlighter-rouge">const-env x v</code> for <code class="highlighter-rouge">δ</code>.  We shall have two cases to
consider, <code class="highlighter-rouge">x ≡ y</code> or <code class="highlighter-rouge">x ≢ y</code>.</p>

<p>Now to finish the two cases of the proof.</p>

<ul>
  <li>In the case where <code class="highlighter-rouge">x ≡ y</code>, we need to show
that <code class="highlighter-rouge">γ ⊢ σ y ↓ v</code>, but that’s just our premise.</li>
  <li>In the case where <code class="highlighter-rouge">x ≢ y,</code> we need to show
that <code class="highlighter-rouge">γ ⊢ σ y ↓ ⊥</code>, which we do via rule <code class="highlighter-rouge">⊥-intro</code>.</li>
</ul>

<p>Thus, we have completed the variable case of the proof that
simultaneous substitution reflects denotations.  Here is the proof
again, formally.</p>

<pre class="Agda"><a id="subst-reflect-var"></a><a id="13960" href="/Soundness/#13960" class="Function">subst-reflect-var</a> <a id="13978" class="Symbol">:</a> <a id="13980" class="Symbol">∀</a> <a id="13982" class="Symbol">{</a><a id="13983" href="/Soundness/#13983" class="Bound">Γ</a> <a id="13985" href="/Soundness/#13985" class="Bound">Δ</a><a id="13986" class="Symbol">}</a> <a id="13988" class="Symbol">{</a><a id="13989" href="/Soundness/#13989" class="Bound">γ</a> <a id="13991" class="Symbol">:</a> <a id="13993" href="/Denotational/#7331" class="Function">Env</a> <a id="13997" href="/Soundness/#13985" class="Bound">Δ</a><a id="13998" class="Symbol">}</a> <a id="14000" class="Symbol">{</a><a id="14001" href="/Soundness/#14001" class="Bound">x</a> <a id="14003" class="Symbol">:</a> <a id="14005" href="/Soundness/#13983" class="Bound">Γ</a> <a id="14007" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="14009" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="14010" class="Symbol">}</a> <a id="14012" class="Symbol">{</a><a id="14013" href="/Soundness/#14013" class="Bound">v</a><a id="14014" class="Symbol">}</a> <a id="14016" class="Symbol">{</a><a id="14017" href="/Soundness/#14017" class="Bound">σ</a> <a id="14019" class="Symbol">:</a> <a id="14021" href="/Soundness/#2482" class="Function">Subst</a> <a id="14027" href="/Soundness/#13983" class="Bound">Γ</a> <a id="14029" href="/Soundness/#13985" class="Bound">Δ</a><a id="14030" class="Symbol">}</a>
  <a id="14034" class="Symbol">→</a> <a id="14036" href="/Soundness/#13989" class="Bound">γ</a> <a id="14038" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="14040" href="/Soundness/#14017" class="Bound">σ</a> <a id="14042" href="/Soundness/#14001" class="Bound">x</a> <a id="14044" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="14046" href="/Soundness/#14013" class="Bound">v</a>
    <a id="14052" class="Comment">-----------------------------------------</a>
  <a id="14096" class="Symbol">→</a> <a id="14098" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ[</a> <a id="14101" href="/Soundness/#14101" class="Bound">δ</a> <a id="14103" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">∈</a> <a id="14105" href="/Denotational/#7331" class="Function">Env</a> <a id="14109" href="/Soundness/#13983" class="Bound">Γ</a> <a id="14111" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">]</a> <a id="14113" href="/Soundness/#13989" class="Bound">γ</a> <a id="14115" href="/Soundness/#2986" class="Function Operator">`⊢</a> <a id="14118" href="/Soundness/#14017" class="Bound">σ</a> <a id="14120" href="/Soundness/#2986" class="Function Operator">↓</a> <a id="14122" href="/Soundness/#14101" class="Bound">δ</a>  <a id="14125" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">×</a>  <a id="14128" href="/Soundness/#14101" class="Bound">δ</a> <a id="14130" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="14132" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="14134" href="/Soundness/#14001" class="Bound">x</a> <a id="14136" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="14138" href="/Soundness/#14013" class="Bound">v</a>
<a id="14140" href="/Soundness/#13960" class="Function">subst-reflect-var</a> <a id="14158" class="Symbol">{</a><a id="14159" href="/Soundness/#14159" class="Bound">Γ</a><a id="14160" class="Symbol">}{</a><a id="14162" href="/Soundness/#14162" class="Bound">Δ</a><a id="14163" class="Symbol">}{</a><a id="14165" href="/Soundness/#14165" class="Bound">γ</a><a id="14166" class="Symbol">}{</a><a id="14168" href="/Soundness/#14168" class="Bound">x</a><a id="14169" class="Symbol">}{</a><a id="14171" href="/Soundness/#14171" class="Bound">v</a><a id="14172" class="Symbol">}{</a><a id="14174" href="/Soundness/#14174" class="Bound">σ</a><a id="14175" class="Symbol">}</a> <a id="14177" href="/Soundness/#14177" class="Bound">xv</a>
  <a id="14182" class="Keyword">rewrite</a> <a id="14190" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="14194" class="Symbol">(</a><a id="14195" href="/Soundness/#12875" class="Function">nth-const-env</a> <a id="14209" class="Symbol">{</a><a id="14210" href="/Soundness/#14159" class="Bound">Γ</a><a id="14211" class="Symbol">}{</a><a id="14213" href="/Soundness/#14168" class="Bound">x</a><a id="14214" class="Symbol">}{</a><a id="14216" href="/Soundness/#14171" class="Bound">v</a><a id="14217" class="Symbol">})</a> <a id="14220" class="Symbol">=</a>
    <a id="14226" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="14228" href="/Soundness/#12640" class="Function">const-env</a> <a id="14238" href="/Soundness/#14168" class="Bound">x</a> <a id="14240" href="/Soundness/#14171" class="Bound">v</a> <a id="14242" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="14244" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="14246" href="/Soundness/#14279" class="Function">const-env-ok</a> <a id="14259" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="14261" href="/Denotational/#9925" class="InductiveConstructor">var</a> <a id="14265" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="14267" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
  <a id="14271" class="Keyword">where</a>
  <a id="14279" href="/Soundness/#14279" class="Function">const-env-ok</a> <a id="14292" class="Symbol">:</a> <a id="14294" href="/Soundness/#14165" class="Bound">γ</a> <a id="14296" href="/Soundness/#2986" class="Function Operator">`⊢</a> <a id="14299" href="/Soundness/#14174" class="Bound">σ</a> <a id="14301" href="/Soundness/#2986" class="Function Operator">↓</a> <a id="14303" href="/Soundness/#12640" class="Function">const-env</a> <a id="14313" href="/Soundness/#14168" class="Bound">x</a> <a id="14315" href="/Soundness/#14171" class="Bound">v</a>
  <a id="14319" href="/Soundness/#14279" class="Function">const-env-ok</a> <a id="14332" href="/Soundness/#14332" class="Bound">y</a> <a id="14334" class="Keyword">with</a> <a id="14339" href="/Soundness/#14168" class="Bound">x</a> <a id="14341" href="/Soundness/#12274" class="Function Operator">var≟</a> <a id="14346" href="/Soundness/#14332" class="Bound">y</a>
  <a id="14350" class="Symbol">...</a> <a id="14354" class="Symbol">|</a> <a id="14356" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="14360" href="/Soundness/#14360" class="Bound">x≡y</a> <a id="14364" class="Keyword">rewrite</a> <a id="14372" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="14376" href="/Soundness/#14360" class="Bound">x≡y</a> <a id="14380" class="Symbol">|</a> <a id="14382" href="/Soundness/#12875" class="Function">nth-const-env</a> <a id="14396" class="Symbol">{</a><a id="14397" href="/Soundness/#14159" class="Bound">Γ</a><a id="14398" class="Symbol">}{</a><a id="14400" href="/Soundness/#14168" class="Bound">x</a><a id="14401" class="Symbol">}{</a><a id="14403" href="/Soundness/#14171" class="Bound">v</a><a id="14404" class="Symbol">}</a> <a id="14406" class="Symbol">=</a> <a id="14408" href="/Soundness/#14177" class="Bound">xv</a>
  <a id="14413" class="Symbol">...</a> <a id="14417" class="Symbol">|</a> <a id="14419" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="14422" href="/Soundness/#14422" class="Bound">x≢y</a> <a id="14426" class="Keyword">rewrite</a> <a id="14434" href="/Soundness/#13085" class="Function">diff-nth-const-env</a> <a id="14453" class="Symbol">{</a><a id="14454" href="/Soundness/#14159" class="Bound">Γ</a><a id="14455" class="Symbol">}{</a><a id="14457" href="/Soundness/#14168" class="Bound">x</a><a id="14458" class="Symbol">}{</a><a id="14460" class="Bound">y</a><a id="14461" class="Symbol">}{</a><a id="14463" href="/Soundness/#14171" class="Bound">v</a><a id="14464" class="Symbol">}</a> <a id="14466" href="/Soundness/#14422" class="Bound">x≢y</a> <a id="14470" class="Symbol">=</a> <a id="14472" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a></pre>

<h3 id="substitutions-and-environment-construction">Substitutions and environment construction</h3>

<p>Every substitution produces terms that can evaluate to <code class="highlighter-rouge">⊥</code>.</p>

<pre class="Agda"><a id="subst-⊥"></a><a id="14615" href="/Soundness/#14615" class="Function">subst-⊥</a> <a id="14623" class="Symbol">:</a> <a id="14625" class="Symbol">∀{</a><a id="14627" href="/Soundness/#14627" class="Bound">Γ</a> <a id="14629" href="/Soundness/#14629" class="Bound">Δ</a><a id="14630" class="Symbol">}{</a><a id="14632" href="/Soundness/#14632" class="Bound">γ</a> <a id="14634" class="Symbol">:</a> <a id="14636" href="/Denotational/#7331" class="Function">Env</a> <a id="14640" href="/Soundness/#14629" class="Bound">Δ</a><a id="14641" class="Symbol">}{</a><a id="14643" href="/Soundness/#14643" class="Bound">σ</a> <a id="14645" class="Symbol">:</a> <a id="14647" href="/Soundness/#2482" class="Function">Subst</a> <a id="14653" href="/Soundness/#14627" class="Bound">Γ</a> <a id="14655" href="/Soundness/#14629" class="Bound">Δ</a><a id="14656" class="Symbol">}</a>
    <a id="14662" class="Comment">-----------------</a>
  <a id="14682" class="Symbol">→</a> <a id="14684" href="/Soundness/#14632" class="Bound">γ</a> <a id="14686" href="/Soundness/#2986" class="Function Operator">`⊢</a> <a id="14689" href="/Soundness/#14643" class="Bound">σ</a> <a id="14691" href="/Soundness/#2986" class="Function Operator">↓</a> <a id="14693" href="/Denotational/#8576" class="Function">`⊥</a>
<a id="14696" href="/Soundness/#14615" class="Function">subst-⊥</a> <a id="14704" href="/Soundness/#14704" class="Bound">x</a> <a id="14706" class="Symbol">=</a> <a id="14708" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a></pre>

<p>If a substitution produces terms that evaluate to the values in
both <code class="highlighter-rouge">γ₁</code> and <code class="highlighter-rouge">γ₂</code>, then those terms also evaluate to the values in 
<code class="highlighter-rouge">γ₁ ⊔ γ₂</code>.</p>

<pre class="Agda"><a id="subst-⊔"></a><a id="14886" href="/Soundness/#14886" class="Function">subst-⊔</a> <a id="14894" class="Symbol">:</a> <a id="14896" class="Symbol">∀{</a><a id="14898" href="/Soundness/#14898" class="Bound">Γ</a> <a id="14900" href="/Soundness/#14900" class="Bound">Δ</a><a id="14901" class="Symbol">}{</a><a id="14903" href="/Soundness/#14903" class="Bound">γ</a> <a id="14905" class="Symbol">:</a> <a id="14907" href="/Denotational/#7331" class="Function">Env</a> <a id="14911" href="/Soundness/#14900" class="Bound">Δ</a><a id="14912" class="Symbol">}{</a><a id="14914" href="/Soundness/#14914" class="Bound">γ₁</a> <a id="14917" href="/Soundness/#14917" class="Bound">γ₂</a> <a id="14920" class="Symbol">:</a> <a id="14922" href="/Denotational/#7331" class="Function">Env</a> <a id="14926" href="/Soundness/#14898" class="Bound">Γ</a><a id="14927" class="Symbol">}{</a><a id="14929" href="/Soundness/#14929" class="Bound">σ</a> <a id="14931" class="Symbol">:</a> <a id="14933" href="/Soundness/#2482" class="Function">Subst</a> <a id="14939" href="/Soundness/#14898" class="Bound">Γ</a> <a id="14941" href="/Soundness/#14900" class="Bound">Δ</a><a id="14942" class="Symbol">}</a>
           <a id="14955" class="Symbol">→</a> <a id="14957" href="/Soundness/#14903" class="Bound">γ</a> <a id="14959" href="/Soundness/#2986" class="Function Operator">`⊢</a> <a id="14962" href="/Soundness/#14929" class="Bound">σ</a> <a id="14964" href="/Soundness/#2986" class="Function Operator">↓</a> <a id="14966" href="/Soundness/#14914" class="Bound">γ₁</a>
           <a id="14980" class="Symbol">→</a> <a id="14982" href="/Soundness/#14903" class="Bound">γ</a> <a id="14984" href="/Soundness/#2986" class="Function Operator">`⊢</a> <a id="14987" href="/Soundness/#14929" class="Bound">σ</a> <a id="14989" href="/Soundness/#2986" class="Function Operator">↓</a> <a id="14991" href="/Soundness/#14917" class="Bound">γ₂</a>
             <a id="15007" class="Comment">-------------------------</a>
           <a id="15044" class="Symbol">→</a> <a id="15046" href="/Soundness/#14903" class="Bound">γ</a> <a id="15048" href="/Soundness/#2986" class="Function Operator">`⊢</a> <a id="15051" href="/Soundness/#14929" class="Bound">σ</a> <a id="15053" href="/Soundness/#2986" class="Function Operator">↓</a> <a id="15055" class="Symbol">(</a><a id="15056" href="/Soundness/#14914" class="Bound">γ₁</a> <a id="15059" href="/Denotational/#8605" class="Function Operator">`⊔</a> <a id="15062" href="/Soundness/#14917" class="Bound">γ₂</a><a id="15064" class="Symbol">)</a>
<a id="15066" href="/Soundness/#14886" class="Function">subst-⊔</a> <a id="15074" href="/Soundness/#15074" class="Bound">γ₁-ok</a> <a id="15080" href="/Soundness/#15080" class="Bound">γ₂-ok</a> <a id="15086" href="/Soundness/#15086" class="Bound">x</a> <a id="15088" class="Symbol">=</a> <a id="15090" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="15098" class="Symbol">(</a><a id="15099" href="/Soundness/#15074" class="Bound">γ₁-ok</a> <a id="15105" href="/Soundness/#15086" class="Bound">x</a><a id="15106" class="Symbol">)</a> <a id="15108" class="Symbol">(</a><a id="15109" href="/Soundness/#15080" class="Bound">γ₂-ok</a> <a id="15115" href="/Soundness/#15086" class="Bound">x</a><a id="15116" class="Symbol">)</a></pre>

<h3 id="the-lambda-constructor-is-injective">The Lambda constructor is injective</h3>

<pre class="Agda"><a id="lambda-inj"></a><a id="15184" href="/Soundness/#15184" class="Function">lambda-inj</a> <a id="15195" class="Symbol">:</a> <a id="15197" class="Symbol">∀</a> <a id="15199" class="Symbol">{</a><a id="15200" href="/Soundness/#15200" class="Bound">Γ</a><a id="15201" class="Symbol">}</a> <a id="15203" class="Symbol">{</a><a id="15204" href="/Soundness/#15204" class="Bound">M</a> <a id="15206" href="/Soundness/#15206" class="Bound">N</a> <a id="15208" class="Symbol">:</a> <a id="15210" href="/Soundness/#15200" class="Bound">Γ</a> <a id="15212" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="15214" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="15216" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15218" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="15220" class="Symbol">}</a>
  <a id="15224" class="Symbol">→</a> <a id="15226" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">_≡_</a> <a id="15230" class="Symbol">{</a><a id="15231" class="Argument">A</a> <a id="15233" class="Symbol">=</a> <a id="15235" href="/Soundness/#15200" class="Bound">Γ</a> <a id="15237" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15239" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15240" class="Symbol">}</a> <a id="15242" class="Symbol">(</a><a id="15243" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="15245" href="/Soundness/#15204" class="Bound">M</a><a id="15246" class="Symbol">)</a> <a id="15248" class="Symbol">(</a><a id="15249" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="15251" href="/Soundness/#15206" class="Bound">N</a><a id="15252" class="Symbol">)</a>
    <a id="15258" class="Comment">---------------------------</a>
  <a id="15288" class="Symbol">→</a> <a id="15290" href="/Soundness/#15204" class="Bound">M</a> <a id="15292" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="15294" href="/Soundness/#15206" class="Bound">N</a>
<a id="15296" href="/Soundness/#15184" class="Function">lambda-inj</a> <a id="15307" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="15312" class="Symbol">=</a> <a id="15314" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a></pre>

<h3 id="simultaneous-substitution-reflects-denotations">Simultaneous substitution reflects denotations</h3>

<p>In this section we prove a central lemma, that
substitution reflects denotations. That is, if <code class="highlighter-rouge">γ ⊢ subst σ M ↓ v</code>, then
<code class="highlighter-rouge">δ ⊢ M ↓ v</code> and <code class="highlighter-rouge">γ ⊢ σ ↓ δ</code> for some <code class="highlighter-rouge">δ</code>. We shall proceed by induction on
the derivation of <code class="highlighter-rouge">γ ⊢ subst σ M ↓ v</code>. This requires a minor
restatement of the lemma, changing the premise to <code class="highlighter-rouge">γ ⊢ L ↓ v</code> and
<code class="highlighter-rouge">L ≡ subst σ M</code>.</p>

<pre class="Agda"><a id="split"></a><a id="15736" href="/Soundness/#15736" class="Function">split</a> <a id="15742" class="Symbol">:</a> <a id="15744" class="Symbol">∀</a> <a id="15746" class="Symbol">{</a><a id="15747" href="/Soundness/#15747" class="Bound">Γ</a><a id="15748" class="Symbol">}</a> <a id="15750" class="Symbol">{</a><a id="15751" href="/Soundness/#15751" class="Bound">M</a> <a id="15753" class="Symbol">:</a> <a id="15755" href="/Soundness/#15747" class="Bound">Γ</a> <a id="15757" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="15759" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="15761" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15763" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15764" class="Symbol">}</a> <a id="15766" class="Symbol">{</a><a id="15767" href="/Soundness/#15767" class="Bound">δ</a> <a id="15769" class="Symbol">:</a> <a id="15771" href="/Denotational/#7331" class="Function">Env</a> <a id="15775" class="Symbol">(</a><a id="15776" href="/Soundness/#15747" class="Bound">Γ</a> <a id="15778" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="15780" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15781" class="Symbol">)}</a> <a id="15784" class="Symbol">{</a><a id="15785" href="/Soundness/#15785" class="Bound">v</a><a id="15786" class="Symbol">}</a>
  <a id="15790" class="Symbol">→</a> <a id="15792" href="/Soundness/#15767" class="Bound">δ</a> <a id="15794" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="15796" href="/Soundness/#15751" class="Bound">M</a> <a id="15798" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="15800" href="/Soundness/#15785" class="Bound">v</a>
    <a id="15806" class="Comment">--------------------------</a>
  <a id="15835" class="Symbol">→</a> <a id="15837" class="Symbol">(</a><a id="15838" href="/Denotational/#7757" class="Function">init</a> <a id="15843" href="/Soundness/#15767" class="Bound">δ</a> <a id="15845" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="15848" href="/Denotational/#7812" class="Function">last</a> <a id="15853" href="/Soundness/#15767" class="Bound">δ</a><a id="15854" class="Symbol">)</a> <a id="15856" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="15858" href="/Soundness/#15751" class="Bound">M</a> <a id="15860" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="15862" href="/Soundness/#15785" class="Bound">v</a>
<a id="15864" href="/Soundness/#15736" class="Function">split</a> <a id="15870" class="Symbol">{</a><a id="15871" class="Argument">δ</a> <a id="15873" class="Symbol">=</a> <a id="15875" href="/Soundness/#15875" class="Bound">δ</a><a id="15876" class="Symbol">}</a> <a id="15878" href="/Soundness/#15878" class="Bound">δMv</a> <a id="15882" class="Keyword">rewrite</a> <a id="15890" href="/Denotational/#7861" class="Function">init-last</a> <a id="15900" href="/Soundness/#15875" class="Bound">δ</a> <a id="15902" class="Symbol">=</a> <a id="15904" href="/Soundness/#15878" class="Bound">δMv</a>

<a id="subst-reflect"></a><a id="15909" href="/Soundness/#15909" class="Function">subst-reflect</a> <a id="15923" class="Symbol">:</a> <a id="15925" class="Symbol">∀</a> <a id="15927" class="Symbol">{</a><a id="15928" href="/Soundness/#15928" class="Bound">Γ</a> <a id="15930" href="/Soundness/#15930" class="Bound">Δ</a><a id="15931" class="Symbol">}</a> <a id="15933" class="Symbol">{</a><a id="15934" href="/Soundness/#15934" class="Bound">δ</a> <a id="15936" class="Symbol">:</a> <a id="15938" href="/Denotational/#7331" class="Function">Env</a> <a id="15942" href="/Soundness/#15930" class="Bound">Δ</a><a id="15943" class="Symbol">}</a> <a id="15945" class="Symbol">{</a><a id="15946" href="/Soundness/#15946" class="Bound">M</a> <a id="15948" class="Symbol">:</a> <a id="15950" href="/Soundness/#15928" class="Bound">Γ</a> <a id="15952" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15954" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15955" class="Symbol">}</a> <a id="15957" class="Symbol">{</a><a id="15958" href="/Soundness/#15958" class="Bound">v</a><a id="15959" class="Symbol">}</a> <a id="15961" class="Symbol">{</a><a id="15962" href="/Soundness/#15962" class="Bound">L</a> <a id="15964" class="Symbol">:</a> <a id="15966" href="/Soundness/#15930" class="Bound">Δ</a> <a id="15968" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15970" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15971" class="Symbol">}</a> <a id="15973" class="Symbol">{</a><a id="15974" href="/Soundness/#15974" class="Bound">σ</a> <a id="15976" class="Symbol">:</a> <a id="15978" href="/Soundness/#2482" class="Function">Subst</a> <a id="15984" href="/Soundness/#15928" class="Bound">Γ</a> <a id="15986" href="/Soundness/#15930" class="Bound">Δ</a><a id="15987" class="Symbol">}</a>
  <a id="15991" class="Symbol">→</a> <a id="15993" href="/Soundness/#15934" class="Bound">δ</a> <a id="15995" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="15997" href="/Soundness/#15962" class="Bound">L</a> <a id="15999" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="16001" href="/Soundness/#15958" class="Bound">v</a>
  <a id="16005" class="Symbol">→</a> <a id="16007" href="/Untyped/#6931" class="Function">subst</a> <a id="16013" href="/Soundness/#15974" class="Bound">σ</a> <a id="16015" href="/Soundness/#15946" class="Bound">M</a> <a id="16017" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="16019" href="/Soundness/#15962" class="Bound">L</a>
    <a id="16025" class="Comment">---------------------------------------</a>
  <a id="16067" class="Symbol">→</a> <a id="16069" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ[</a> <a id="16072" href="/Soundness/#16072" class="Bound">γ</a> <a id="16074" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">∈</a> <a id="16076" href="/Denotational/#7331" class="Function">Env</a> <a id="16080" href="/Soundness/#15928" class="Bound">Γ</a> <a id="16082" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">]</a> <a id="16084" href="/Soundness/#15934" class="Bound">δ</a> <a id="16086" href="/Soundness/#2986" class="Function Operator">`⊢</a> <a id="16089" href="/Soundness/#15974" class="Bound">σ</a> <a id="16091" href="/Soundness/#2986" class="Function Operator">↓</a> <a id="16093" href="/Soundness/#16072" class="Bound">γ</a>  <a id="16096" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">×</a>  <a id="16099" href="/Soundness/#16072" class="Bound">γ</a> <a id="16101" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="16103" href="/Soundness/#15946" class="Bound">M</a> <a id="16105" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="16107" href="/Soundness/#15958" class="Bound">v</a>

<a id="16110" href="/Soundness/#15909" class="Function">subst-reflect</a> <a id="16124" class="Symbol">{</a><a id="16125" class="Argument">M</a> <a id="16127" class="Symbol">=</a> <a id="16129" href="/Soundness/#16129" class="Bound">M</a><a id="16130" class="Symbol">}{</a><a id="16132" class="Argument">σ</a> <a id="16134" class="Symbol">=</a> <a id="16136" href="/Soundness/#16136" class="Bound">σ</a><a id="16137" class="Symbol">}</a> <a id="16139" class="Symbol">(</a><a id="16140" href="/Denotational/#9925" class="InductiveConstructor">var</a> <a id="16144" class="Symbol">{</a><a id="16145" class="Argument">x</a> <a id="16147" class="Symbol">=</a> <a id="16149" href="/Soundness/#16149" class="Bound">y</a><a id="16150" class="Symbol">})</a> <a id="16153" href="/Soundness/#16153" class="Bound">eqL</a> <a id="16157" class="Keyword">with</a> <a id="16162" href="/Soundness/#16129" class="Bound">M</a> 
<a id="16165" class="Symbol">...</a> <a id="16169" class="Symbol">|</a> <a id="16171" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="16173" href="/Soundness/#16173" class="Bound">x</a>  <a id="16176" class="Keyword">with</a> <a id="16181" href="/Denotational/#9925" class="InductiveConstructor">var</a> <a id="16185" class="Symbol">{</a><a id="16186" class="Argument">x</a> <a id="16188" class="Symbol">=</a> <a id="16190" class="Bound">y</a><a id="16191" class="Symbol">}</a>
<a id="16193" class="Symbol">...</a>           <a id="16207" class="Symbol">|</a> <a id="16209" href="/Soundness/#16209" class="Bound">yv</a>  <a id="16213" class="Keyword">rewrite</a> <a id="16221" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="16225" class="Bound">eqL</a> <a id="16229" class="Symbol">=</a> <a id="16231" href="/Soundness/#13960" class="Function">subst-reflect-var</a> <a id="16249" class="Symbol">{</a><a id="16250" class="Argument">σ</a> <a id="16252" class="Symbol">=</a> <a id="16254" class="Bound">σ</a><a id="16255" class="Symbol">}</a> <a id="16257" href="/Soundness/#16209" class="Bound">yv</a>
<a id="16260" href="/Soundness/#15909" class="Function">subst-reflect</a> <a id="16274" class="Symbol">{</a><a id="16275" class="Argument">M</a> <a id="16277" class="Symbol">=</a> <a id="16279" href="/Soundness/#16279" class="Bound">M</a><a id="16280" class="Symbol">}</a> <a id="16282" class="Symbol">(</a><a id="16283" href="/Denotational/#9925" class="InductiveConstructor">var</a> <a id="16287" class="Symbol">{</a><a id="16288" class="Argument">x</a> <a id="16290" class="Symbol">=</a> <a id="16292" href="/Soundness/#16292" class="Bound">y</a><a id="16293" class="Symbol">})</a> <a id="16296" class="Symbol">()</a> <a id="16299" class="Symbol">|</a> <a id="16301" href="/Soundness/#16301" class="Bound">M₁</a> <a id="16304" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="16306" href="/Soundness/#16306" class="Bound">M₂</a>
<a id="16309" href="/Soundness/#15909" class="Function">subst-reflect</a> <a id="16323" class="Symbol">{</a><a id="16324" class="Argument">M</a> <a id="16326" class="Symbol">=</a> <a id="16328" href="/Soundness/#16328" class="Bound">M</a><a id="16329" class="Symbol">}</a> <a id="16331" class="Symbol">(</a><a id="16332" href="/Denotational/#9925" class="InductiveConstructor">var</a> <a id="16336" class="Symbol">{</a><a id="16337" class="Argument">x</a> <a id="16339" class="Symbol">=</a> <a id="16341" href="/Soundness/#16341" class="Bound">y</a><a id="16342" class="Symbol">})</a> <a id="16345" class="Symbol">()</a> <a id="16348" class="Symbol">|</a> <a id="16350" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="16352" href="/Soundness/#16352" class="Bound">M&#39;</a>

<a id="16356" href="/Soundness/#15909" class="Function">subst-reflect</a> <a id="16370" class="Symbol">{</a><a id="16371" class="Argument">M</a> <a id="16373" class="Symbol">=</a> <a id="16375" href="/Soundness/#16375" class="Bound">M</a><a id="16376" class="Symbol">}{</a><a id="16378" class="Argument">σ</a> <a id="16380" class="Symbol">=</a> <a id="16382" href="/Soundness/#16382" class="Bound">σ</a><a id="16383" class="Symbol">}</a> <a id="16385" class="Symbol">(</a><a id="16386" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="16393" href="/Soundness/#16393" class="Bound">d₁</a> <a id="16396" href="/Soundness/#16396" class="Bound">d₂</a><a id="16398" class="Symbol">)</a> <a id="16400" href="/Soundness/#16400" class="Bound">eqL</a>
         <a id="16413" class="Keyword">with</a> <a id="16418" href="/Soundness/#16375" class="Bound">M</a> 
<a id="16421" class="Symbol">...</a>    <a id="16428" class="Symbol">|</a> <a id="16430" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="16432" href="/Soundness/#16432" class="Bound">x</a> <a id="16434" class="Keyword">with</a> <a id="16439" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="16446" class="Bound">d₁</a> <a id="16449" class="Bound">d₂</a> 
<a id="16453" class="Symbol">...</a>    <a id="16460" class="Symbol">|</a> <a id="16462" href="/Soundness/#16462" class="Bound">d&#39;</a> <a id="16465" class="Keyword">rewrite</a> <a id="16473" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="16477" class="Bound">eqL</a> <a id="16481" class="Symbol">=</a> <a id="16483" href="/Soundness/#13960" class="Function">subst-reflect-var</a> <a id="16501" class="Symbol">{</a><a id="16502" class="Argument">σ</a> <a id="16504" class="Symbol">=</a> <a id="16506" class="Bound">σ</a><a id="16507" class="Symbol">}</a> <a id="16509" href="/Soundness/#16462" class="Bound">d&#39;</a>
<a id="16512" href="/Soundness/#15909" class="Function">subst-reflect</a> <a id="16526" class="Symbol">(</a><a id="16527" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="16534" href="/Soundness/#16534" class="Bound">d₁</a> <a id="16537" href="/Soundness/#16537" class="Bound">d₂</a><a id="16539" class="Symbol">)</a> <a id="16541" class="Symbol">()</a> <a id="16544" class="Symbol">|</a> <a id="16546" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="16548" href="/Soundness/#16548" class="Bound">M&#39;</a>
<a id="16551" href="/Soundness/#15909" class="Function">subst-reflect</a><a id="16564" class="Symbol">{</a><a id="16565" href="/Soundness/#16565" class="Bound">Γ</a><a id="16566" class="Symbol">}{</a><a id="16568" href="/Soundness/#16568" class="Bound">Δ</a><a id="16569" class="Symbol">}{</a><a id="16571" href="/Soundness/#16571" class="Bound">γ</a><a id="16572" class="Symbol">}{</a><a id="16574" class="Argument">σ</a> <a id="16576" class="Symbol">=</a> <a id="16578" href="/Soundness/#16578" class="Bound">σ</a><a id="16579" class="Symbol">}</a> <a id="16581" class="Symbol">(</a><a id="16582" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="16589" href="/Soundness/#16589" class="Bound">d₁</a> <a id="16592" href="/Soundness/#16592" class="Bound">d₂</a><a id="16594" class="Symbol">)</a>
   <a id="16599" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="16604" class="Symbol">|</a> <a id="16606" href="/Soundness/#16606" class="Bound">M₁</a> <a id="16609" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="16611" href="/Soundness/#16611" class="Bound">M₂</a>
     <a id="16619" class="Keyword">with</a> <a id="16624" href="/Soundness/#15909" class="Function">subst-reflect</a> <a id="16638" class="Symbol">{</a><a id="16639" class="Argument">M</a> <a id="16641" class="Symbol">=</a> <a id="16643" href="/Soundness/#16606" class="Bound">M₁</a><a id="16645" class="Symbol">}</a> <a id="16647" href="/Soundness/#16589" class="Bound">d₁</a> <a id="16650" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="16655" class="Symbol">|</a> <a id="16657" href="/Soundness/#15909" class="Function">subst-reflect</a> <a id="16671" class="Symbol">{</a><a id="16672" class="Argument">M</a> <a id="16674" class="Symbol">=</a> <a id="16676" href="/Soundness/#16611" class="Bound">M₂</a><a id="16678" class="Symbol">}</a> <a id="16680" href="/Soundness/#16592" class="Bound">d₂</a> <a id="16683" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="16688" class="Symbol">...</a>     <a id="16696" class="Symbol">|</a> <a id="16698" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16700" href="/Soundness/#16700" class="Bound">δ₁</a> <a id="16703" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16705" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16707" href="/Soundness/#16707" class="Bound">subst-δ₁</a> <a id="16716" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16718" href="/Soundness/#16718" class="Bound">m1</a> <a id="16721" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16723" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16725" class="Symbol">|</a> <a id="16727" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16729" href="/Soundness/#16729" class="Bound">δ₂</a> <a id="16732" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16734" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16736" href="/Soundness/#16736" class="Bound">subst-δ₂</a> <a id="16745" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16747" href="/Soundness/#16747" class="Bound">m2</a> <a id="16750" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16752" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16754" class="Symbol">=</a>
     <a id="16761" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16763" href="/Soundness/#16700" class="Bound">δ₁</a> <a id="16766" href="/Denotational/#8605" class="Function Operator">`⊔</a> <a id="16769" href="/Soundness/#16729" class="Bound">δ₂</a> <a id="16772" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16774" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16776" href="/Soundness/#14886" class="Function">subst-⊔</a> <a id="16784" class="Symbol">{</a><a id="16785" class="Argument">γ₁</a> <a id="16788" class="Symbol">=</a> <a id="16790" href="/Soundness/#16700" class="Bound">δ₁</a><a id="16792" class="Symbol">}{</a><a id="16794" class="Argument">γ₂</a> <a id="16797" class="Symbol">=</a> <a id="16799" href="/Soundness/#16729" class="Bound">δ₂</a><a id="16801" class="Symbol">}{</a><a id="16803" class="Argument">σ</a> <a id="16805" class="Symbol">=</a> <a id="16807" class="Bound">σ</a><a id="16808" class="Symbol">}</a> <a id="16810" href="/Soundness/#16707" class="Bound">subst-δ₁</a> <a id="16819" href="/Soundness/#16736" class="Bound">subst-δ₂</a> <a id="16828" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a>
                    <a id="16850" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="16857" class="Symbol">(</a><a id="16858" href="/Denotational/#26929" class="Function">Env⊑</a> <a id="16863" href="/Soundness/#16718" class="Bound">m1</a> <a id="16866" class="Symbol">(</a><a id="16867" href="/Denotational/#8943" class="Function">EnvConjR1⊑</a> <a id="16878" href="/Soundness/#16700" class="Bound">δ₁</a> <a id="16881" href="/Soundness/#16729" class="Bound">δ₂</a><a id="16883" class="Symbol">))</a>
                           <a id="16913" class="Symbol">(</a><a id="16914" href="/Denotational/#26929" class="Function">Env⊑</a> <a id="16919" href="/Soundness/#16747" class="Bound">m2</a> <a id="16922" class="Symbol">(</a><a id="16923" href="/Denotational/#9040" class="Function">EnvConjR2⊑</a> <a id="16934" href="/Soundness/#16700" class="Bound">δ₁</a> <a id="16937" href="/Soundness/#16729" class="Bound">δ₂</a><a id="16939" class="Symbol">))</a> <a id="16942" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16944" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>

<a id="16947" href="/Soundness/#15909" class="Function">subst-reflect</a> <a id="16961" class="Symbol">{</a><a id="16962" class="Argument">M</a> <a id="16964" class="Symbol">=</a> <a id="16966" href="/Soundness/#16966" class="Bound">M</a><a id="16967" class="Symbol">}{</a><a id="16969" class="Argument">σ</a> <a id="16971" class="Symbol">=</a> <a id="16973" href="/Soundness/#16973" class="Bound">σ</a><a id="16974" class="Symbol">}</a> <a id="16976" class="Symbol">(</a><a id="16977" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="16985" href="/Soundness/#16985" class="Bound">d</a><a id="16986" class="Symbol">)</a> <a id="16988" href="/Soundness/#16988" class="Bound">eqL</a> <a id="16992" class="Keyword">with</a> <a id="16997" href="/Soundness/#16966" class="Bound">M</a>
<a id="16999" class="Symbol">...</a>    <a id="17006" class="Symbol">|</a> <a id="17008" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="17010" href="/Soundness/#17010" class="Bound">x</a> <a id="17012" class="Keyword">with</a> <a id="17017" class="Symbol">(</a><a id="17018" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="17026" class="Bound">d</a><a id="17027" class="Symbol">)</a>
<a id="17029" class="Symbol">...</a>             <a id="17045" class="Symbol">|</a> <a id="17047" href="/Soundness/#17047" class="Bound">d&#39;</a> <a id="17050" class="Keyword">rewrite</a> <a id="17058" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="17062" class="Bound">eqL</a> <a id="17066" class="Symbol">=</a> <a id="17068" href="/Soundness/#13960" class="Function">subst-reflect-var</a> <a id="17086" class="Symbol">{</a><a id="17087" class="Argument">σ</a> <a id="17089" class="Symbol">=</a> <a id="17091" class="Bound">σ</a><a id="17092" class="Symbol">}</a> <a id="17094" href="/Soundness/#17047" class="Bound">d&#39;</a>
<a id="17097" href="/Soundness/#15909" class="Function">subst-reflect</a> <a id="17111" class="Symbol">{</a><a id="17112" class="Argument">σ</a> <a id="17114" class="Symbol">=</a> <a id="17116" href="/Soundness/#17116" class="Bound">σ</a><a id="17117" class="Symbol">}</a> <a id="17119" class="Symbol">(</a><a id="17120" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="17128" href="/Soundness/#17128" class="Bound">d</a><a id="17129" class="Symbol">)</a> <a id="17131" href="/Soundness/#17131" class="Bound">eq</a> <a id="17134" class="Symbol">|</a> <a id="17136" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="17138" href="/Soundness/#17138" class="Bound">M&#39;</a>
      <a id="17147" class="Keyword">with</a> <a id="17152" href="/Soundness/#15909" class="Function">subst-reflect</a> <a id="17166" class="Symbol">{</a><a id="17167" class="Argument">σ</a> <a id="17169" class="Symbol">=</a> <a id="17171" href="/Untyped/#6623" class="Function">exts</a> <a id="17176" href="/Soundness/#17116" class="Bound">σ</a><a id="17177" class="Symbol">}</a> <a id="17179" href="/Soundness/#17128" class="Bound">d</a> <a id="17181" class="Symbol">(</a><a id="17182" href="/Soundness/#15184" class="Function">lambda-inj</a> <a id="17193" href="/Soundness/#17131" class="Bound">eq</a><a id="17195" class="Symbol">)</a>
<a id="17197" class="Symbol">...</a> <a id="17201" class="Symbol">|</a> <a id="17203" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17205" href="/Soundness/#17205" class="Bound">δ′</a> <a id="17208" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17210" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17212" href="/Soundness/#17212" class="Bound">exts-σ-δ′</a> <a id="17222" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17224" href="/Soundness/#17224" class="Bound">m′</a> <a id="17227" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17229" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17231" class="Symbol">=</a> 
    <a id="17238" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17240" href="/Denotational/#7757" class="Function">init</a> <a id="17245" href="/Soundness/#17205" class="Bound">δ′</a> <a id="17248" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17250" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17252" class="Symbol">((λ</a> <a id="17256" href="/Soundness/#17256" class="Bound">x</a> <a id="17258" class="Symbol">→</a> <a id="17260" href="/Soundness/#11098" class="Function">rename-inc-reflect</a> <a id="17279" class="Symbol">(</a><a id="17280" href="/Soundness/#17212" class="Bound">exts-σ-δ′</a> <a id="17290" class="Symbol">(</a><a id="17291" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="17293" href="/Soundness/#17256" class="Bound">x</a><a id="17294" class="Symbol">))))</a> <a id="17299" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a>
             <a id="17314" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="17322" class="Symbol">(</a><a id="17323" href="/Denotational/#27363" class="Function">up-env</a> <a id="17330" class="Symbol">(</a><a id="17331" href="/Soundness/#15736" class="Function">split</a> <a id="17337" href="/Soundness/#17224" class="Bound">m′</a><a id="17339" class="Symbol">)</a> <a id="17341" class="Symbol">(</a><a id="17342" href="/Compositional/#9007" class="Function">var-inv</a> <a id="17350" class="Symbol">(</a><a id="17351" href="/Soundness/#17212" class="Bound">exts-σ-δ′</a> <a id="17361" href="/Untyped/#3401" class="InductiveConstructor">Z</a><a id="17362" class="Symbol">)))</a> <a id="17366" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17368" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="17370" href="/Soundness/#15909" class="Function">subst-reflect</a> <a id="17384" class="Symbol">(</a><a id="17385" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="17393" href="/Soundness/#17393" class="Bound">d</a><a id="17394" class="Symbol">)</a> <a id="17396" class="Symbol">()</a> <a id="17399" class="Symbol">|</a> <a id="17401" href="/Soundness/#17401" class="Bound">M₁</a> <a id="17404" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="17406" href="/Soundness/#17406" class="Bound">M₂</a> 

<a id="17411" href="/Soundness/#15909" class="Function">subst-reflect</a> <a id="17425" class="Symbol">{</a><a id="17426" class="Argument">σ</a> <a id="17428" class="Symbol">=</a> <a id="17430" href="/Soundness/#17430" class="Bound">σ</a><a id="17431" class="Symbol">}</a> <a id="17433" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a> <a id="17441" href="/Soundness/#17441" class="Bound">eq</a> <a id="17444" class="Symbol">=</a>
    <a id="17450" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17452" href="/Denotational/#8576" class="Function">`⊥</a> <a id="17455" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17457" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17459" href="/Soundness/#14615" class="Function">subst-⊥</a> <a id="17467" class="Symbol">{</a><a id="17468" class="Argument">σ</a> <a id="17470" class="Symbol">=</a> <a id="17472" href="/Soundness/#17430" class="Bound">σ</a><a id="17473" class="Symbol">}</a> <a id="17475" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17477" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a> <a id="17485" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17487" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>

<a id="17490" href="/Soundness/#15909" class="Function">subst-reflect</a> <a id="17504" class="Symbol">{</a><a id="17505" class="Argument">σ</a> <a id="17507" class="Symbol">=</a> <a id="17509" href="/Soundness/#17509" class="Bound">σ</a><a id="17510" class="Symbol">}</a> <a id="17512" class="Symbol">(</a><a id="17513" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="17521" href="/Soundness/#17521" class="Bound">d₁</a> <a id="17524" href="/Soundness/#17524" class="Bound">d₂</a><a id="17526" class="Symbol">)</a> <a id="17528" href="/Soundness/#17528" class="Bound">eq</a>
  <a id="17533" class="Keyword">with</a> <a id="17538" href="/Soundness/#15909" class="Function">subst-reflect</a> <a id="17552" class="Symbol">{</a><a id="17553" class="Argument">σ</a> <a id="17555" class="Symbol">=</a> <a id="17557" href="/Soundness/#17509" class="Bound">σ</a><a id="17558" class="Symbol">}</a> <a id="17560" href="/Soundness/#17521" class="Bound">d₁</a> <a id="17563" href="/Soundness/#17528" class="Bound">eq</a> <a id="17566" class="Symbol">|</a> <a id="17568" href="/Soundness/#15909" class="Function">subst-reflect</a> <a id="17582" class="Symbol">{</a><a id="17583" class="Argument">σ</a> <a id="17585" class="Symbol">=</a> <a id="17587" href="/Soundness/#17509" class="Bound">σ</a><a id="17588" class="Symbol">}</a> <a id="17590" href="/Soundness/#17524" class="Bound">d₂</a> <a id="17593" href="/Soundness/#17528" class="Bound">eq</a>
<a id="17596" class="Symbol">...</a> <a id="17600" class="Symbol">|</a> <a id="17602" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17604" href="/Soundness/#17604" class="Bound">δ₁</a> <a id="17607" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17609" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17611" href="/Soundness/#17611" class="Bound">subst-δ₁</a> <a id="17620" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17622" href="/Soundness/#17622" class="Bound">m1</a> <a id="17625" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17627" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17629" class="Symbol">|</a> <a id="17631" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17633" href="/Soundness/#17633" class="Bound">δ₂</a> <a id="17636" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17638" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17640" href="/Soundness/#17640" class="Bound">subst-δ₂</a> <a id="17649" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17651" href="/Soundness/#17651" class="Bound">m2</a> <a id="17654" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17656" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17658" class="Symbol">=</a>
     <a id="17665" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17667" href="/Soundness/#17604" class="Bound">δ₁</a> <a id="17670" href="/Denotational/#8605" class="Function Operator">`⊔</a> <a id="17673" href="/Soundness/#17633" class="Bound">δ₂</a> <a id="17676" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17678" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17680" href="/Soundness/#14886" class="Function">subst-⊔</a> <a id="17688" class="Symbol">{</a><a id="17689" class="Argument">γ₁</a> <a id="17692" class="Symbol">=</a> <a id="17694" href="/Soundness/#17604" class="Bound">δ₁</a><a id="17696" class="Symbol">}{</a><a id="17698" class="Argument">γ₂</a> <a id="17701" class="Symbol">=</a> <a id="17703" href="/Soundness/#17633" class="Bound">δ₂</a><a id="17705" class="Symbol">}{</a><a id="17707" class="Argument">σ</a> <a id="17709" class="Symbol">=</a> <a id="17711" class="Bound">σ</a><a id="17712" class="Symbol">}</a> <a id="17714" href="/Soundness/#17611" class="Bound">subst-δ₁</a> <a id="17723" href="/Soundness/#17640" class="Bound">subst-δ₂</a> <a id="17732" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a>
                    <a id="17754" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="17762" class="Symbol">(</a><a id="17763" href="/Denotational/#26929" class="Function">Env⊑</a> <a id="17768" href="/Soundness/#17622" class="Bound">m1</a> <a id="17771" class="Symbol">(</a><a id="17772" href="/Denotational/#8943" class="Function">EnvConjR1⊑</a> <a id="17783" href="/Soundness/#17604" class="Bound">δ₁</a> <a id="17786" href="/Soundness/#17633" class="Bound">δ₂</a><a id="17788" class="Symbol">))</a>
                            <a id="17819" class="Symbol">(</a><a id="17820" href="/Denotational/#26929" class="Function">Env⊑</a> <a id="17825" href="/Soundness/#17651" class="Bound">m2</a> <a id="17828" class="Symbol">(</a><a id="17829" href="/Denotational/#9040" class="Function">EnvConjR2⊑</a> <a id="17840" href="/Soundness/#17604" class="Bound">δ₁</a> <a id="17843" href="/Soundness/#17633" class="Bound">δ₂</a><a id="17845" class="Symbol">))</a> <a id="17848" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17850" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="17852" href="/Soundness/#15909" class="Function">subst-reflect</a> <a id="17866" class="Symbol">(</a><a id="17867" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="17871" href="/Soundness/#17871" class="Bound">d</a> <a id="17873" href="/Soundness/#17873" class="Bound">lt</a><a id="17875" class="Symbol">)</a> <a id="17877" href="/Soundness/#17877" class="Bound">eq</a> 
    <a id="17885" class="Keyword">with</a> <a id="17890" href="/Soundness/#15909" class="Function">subst-reflect</a> <a id="17904" href="/Soundness/#17871" class="Bound">d</a> <a id="17906" href="/Soundness/#17877" class="Bound">eq</a>
<a id="17909" class="Symbol">...</a> <a id="17913" class="Symbol">|</a> <a id="17915" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17917" href="/Soundness/#17917" class="Bound">δ</a> <a id="17919" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17921" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17923" href="/Soundness/#17923" class="Bound">subst-δ</a> <a id="17931" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17933" href="/Soundness/#17933" class="Bound">m</a> <a id="17935" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17937" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17939" class="Symbol">=</a> <a id="17941" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17943" href="/Soundness/#17917" class="Bound">δ</a> <a id="17945" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17947" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17949" href="/Soundness/#17923" class="Bound">subst-δ</a> <a id="17957" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17959" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="17963" href="/Soundness/#17933" class="Bound">m</a> <a id="17965" class="Bound">lt</a> <a id="17968" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17970" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a></pre>

<ul>
  <li>
    <p>Case <code class="highlighter-rouge">var</code>: We have subst <code class="highlighter-rouge">σ M ≡ y</code>, so <code class="highlighter-rouge">M</code> must also be a variable, say <code class="highlighter-rouge">x</code>.
We apply the lemma <code class="highlighter-rouge">subst-reflect-var</code> to conclude.</p>
  </li>
  <li>Case <code class="highlighter-rouge">↦-elim</code>: We have <code class="highlighter-rouge">subst σ M ≡ L₁ · L₂</code>. We proceed by cases on <code class="highlighter-rouge">M</code>.
    <ul>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ x</code>: We apply the <code class="highlighter-rouge">subst-reflect-var</code> lemma again to conclude.</p>
      </li>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ M₁ · M₂</code>: By the induction hypothesis, we have
some <code class="highlighter-rouge">δ₁</code> and <code class="highlighter-rouge">δ₂</code> such that <code class="highlighter-rouge">δ₁ ⊢ M₁ ↓ v₁ ↦ v₃</code> and <code class="highlighter-rouge">γ ⊢ σ ↓ δ₁</code>,
as well as <code class="highlighter-rouge">δ₂ ⊢ M₂ ↓ v₁</code> and <code class="highlighter-rouge">γ ⊢ σ ↓ δ₂</code>.
By <code class="highlighter-rouge">Env⊑</code> we have <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M₁ ↓ v₁ ↦ v₃</code> and <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M₂ ↓ v₁</code>
(using <code class="highlighter-rouge">EnvConjR1⊑</code> and <code class="highlighter-rouge">EnvConjR2⊑</code>), and therefore
<code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M₁ · M₂ ↓ v₃</code>.
We conclude this case by obtaining <code class="highlighter-rouge">γ ⊢ σ ↓ δ₁ ⊔ δ₂</code>
by the <code class="highlighter-rouge">subst-⊔</code> lemma.</p>
      </li>
    </ul>
  </li>
  <li>Case <code class="highlighter-rouge">↦-intro</code>: We have <code class="highlighter-rouge">subst σ M ≡ ƛ L'</code>. We proceed by cases on <code class="highlighter-rouge">M</code>.
    <ul>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ x</code>: We apply the <code class="highlighter-rouge">subst-reflect-var</code> lemma.</p>
      </li>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ ƛ M'</code>: By the induction hypothesis, we have
<code class="highlighter-rouge">(δ' , v') ⊢ M' ↓ v₂</code> and <code class="highlighter-rouge">(δ , v₁) ⊢ exts σ ↓ (δ' , v')</code>.
From the later we have <code class="highlighter-rouge">(δ , v₁) ⊢ # 0 ↓ v'</code>.
By the lemma <code class="highlighter-rouge">var-inv</code> we have <code class="highlighter-rouge">v' ⊑ v₁</code>, so by the <code class="highlighter-rouge">up-env</code> lemma we
have <code class="highlighter-rouge">(δ' , v₁) ⊢ M' ↓ v₂</code> and therefore <code class="highlighter-rouge">δ' ⊢ ƛ M' ↓ v₁ → v₂</code>.  We
also need to show that <code class="highlighter-rouge">δ </code>⊢ σ ↓ δ’<code class="highlighter-rouge">.  Fix </code>k<code class="highlighter-rouge">. We have
</code>(δ , v₁) ⊢ rename S_ σ k ↓ nth k δ’<code class="highlighter-rouge">.  We then apply the lemma
</code>rename-inc-reflect<code class="highlighter-rouge"> to obtain </code>δ ⊢ σ k ↓ nth k δ’`, so this case is
complete.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Case <code class="highlighter-rouge">⊥-intro</code>: We choose <code class="highlighter-rouge">⊥</code> for <code class="highlighter-rouge">δ</code>.
We have <code class="highlighter-rouge">⊥ ⊢ M ↓ ⊥</code> by <code class="highlighter-rouge">⊥-intro</code>.
We have <code class="highlighter-rouge">δ ⊢ σ ↓ ⊥</code> by the lemma <code class="highlighter-rouge">subst-empty</code>.</p>
  </li>
  <li>Case <code class="highlighter-rouge">⊔-intro</code>: By the induction hypothesis we have
<code class="highlighter-rouge">δ₁ ⊢ M ↓ v₁</code>, <code class="highlighter-rouge">δ₂ ⊢ M ↓ v₂</code>, <code class="highlighter-rouge">δ ⊢ σ ↓ δ₁</code>, and <code class="highlighter-rouge">δ ⊢ σ ↓ δ₂</code>.
We have <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M ↓ v₁</code> and <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M ↓ v₂</code>
by <code class="highlighter-rouge">Env⊑</code> with <code class="highlighter-rouge">EnvConjR1⊑</code> and <code class="highlighter-rouge">EnvConjR2⊑</code>.
So by <code class="highlighter-rouge">⊔-intro</code> we have <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M ↓ v₁ ⊔ v₂</code>.
By <code class="highlighter-rouge">subst-⊔</code> we conclude that <code class="highlighter-rouge">δ ⊢ σ ↓ δ₁ ⊔ δ₂</code>.</li>
</ul>

<h3 id="single-substitution-reflects-denotations">Single substitution reflects denotations</h3>

<p>Most of the work is now behind us. We have proved that simultaneous
substitution reflects denotations. Of course, β reduction uses single
substitution, so we need a corollary that proves that single
substitution reflects denotations. That is,
give terms <code class="highlighter-rouge">N : (Γ , ★ ⊢ ★)</code> and <code class="highlighter-rouge">M : (Γ ⊢ ★)</code>,
if <code class="highlighter-rouge">γ ⊢ N [ M ] ↓ w</code>, then <code class="highlighter-rouge">γ ⊢ M ↓ v</code> and <code class="highlighter-rouge">(γ , v) ⊢ N ↓ w</code>
for some value <code class="highlighter-rouge">v</code>. We have <code class="highlighter-rouge">N [ M ] = subst (subst-zero M) N</code>.
We apply the <code class="highlighter-rouge">subst-reflect</code> lemma to obtain
<code class="highlighter-rouge">γ ⊢ subst-zero M ↓ (δ' , v')</code> and <code class="highlighter-rouge">(δ' , v') ⊢ N ↓ w</code>
for some <code class="highlighter-rouge">δ'</code> and <code class="highlighter-rouge">v'</code>.</p>

<p>Instantiating <code class="highlighter-rouge">γ ⊢ subst-zero M ↓ (δ' , v')</code> at <code class="highlighter-rouge">k = 0</code>
gives us <code class="highlighter-rouge">γ ⊢ M ↓ v'</code>. We choose <code class="highlighter-rouge">w = v'</code>, so the first
part of our conclusion is complete.</p>

<p>It remains to prove <code class="highlighter-rouge">(γ , v') ⊢ N ↓ v</code>. First, we obtain 
<code class="highlighter-rouge">(γ , v') ⊢ rename var-id N ↓ v</code> by the <code class="highlighter-rouge">rename-pres</code> lemma
applied to <code class="highlighter-rouge">(δ' , v') ⊢ N ↓ v</code>, with the <code class="highlighter-rouge">var-id</code> renaming,
<code class="highlighter-rouge">γ = (δ' , v')</code>, and <code class="highlighter-rouge">δ = (γ , v')</code>. To apply this lemma,
we need to show that 
<code class="highlighter-rouge">nth n (δ' , v') ⊑ nth (var-id n) (γ , v')</code> for any <code class="highlighter-rouge">n</code>.
This is accomplished by the following lemma, which
makes use of <code class="highlighter-rouge">γ ⊢ subst-zero M ↓ (δ' , v')</code>.</p>

<pre class="Agda"><a id="nth-id-le"></a><a id="20976" href="/Soundness/#20976" class="Function">nth-id-le</a> <a id="20986" class="Symbol">:</a> <a id="20988" class="Symbol">∀{</a><a id="20990" href="/Soundness/#20990" class="Bound">Γ</a><a id="20991" class="Symbol">}{</a><a id="20993" href="/Soundness/#20993" class="Bound">δ&#39;</a><a id="20995" class="Symbol">}{</a><a id="20997" href="/Soundness/#20997" class="Bound">v&#39;</a><a id="20999" class="Symbol">}{</a><a id="21001" href="/Soundness/#21001" class="Bound">γ</a><a id="21002" class="Symbol">}{</a><a id="21004" href="/Soundness/#21004" class="Bound">M</a><a id="21005" class="Symbol">}</a>
      <a id="21013" class="Symbol">→</a> <a id="21015" href="/Soundness/#21001" class="Bound">γ</a> <a id="21017" href="/Soundness/#2986" class="Function Operator">`⊢</a> <a id="21020" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="21031" href="/Soundness/#21004" class="Bound">M</a> <a id="21033" href="/Soundness/#2986" class="Function Operator">↓</a> <a id="21035" class="Symbol">(</a><a id="21036" href="/Soundness/#20993" class="Bound">δ&#39;</a> <a id="21039" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="21042" href="/Soundness/#20997" class="Bound">v&#39;</a><a id="21044" class="Symbol">)</a>
        <a id="21054" class="Comment">-----------------------------------------------------</a>
      <a id="21114" class="Symbol">→</a> <a id="21116" class="Symbol">(</a><a id="21117" href="/Soundness/#21117" class="Bound">x</a> <a id="21119" class="Symbol">:</a> <a id="21121" href="/Soundness/#20990" class="Bound">Γ</a> <a id="21123" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="21125" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="21127" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="21129" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="21130" class="Symbol">)</a> <a id="21132" class="Symbol">→</a> <a id="21134" class="Symbol">(</a><a id="21135" href="/Soundness/#20993" class="Bound">δ&#39;</a> <a id="21138" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="21141" href="/Soundness/#20997" class="Bound">v&#39;</a><a id="21143" class="Symbol">)</a> <a id="21145" href="/Soundness/#21117" class="Bound">x</a> <a id="21147" href="/Denotational/#4468" class="Datatype Operator">⊑</a> <a id="21149" class="Symbol">(</a><a id="21150" href="/Soundness/#21001" class="Bound">γ</a> <a id="21152" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="21155" href="/Soundness/#20997" class="Bound">v&#39;</a><a id="21157" class="Symbol">)</a> <a id="21159" class="Symbol">(</a><a id="21160" href="/Denotational/#26581" class="Function">var-id</a> <a id="21167" href="/Soundness/#21117" class="Bound">x</a><a id="21168" class="Symbol">)</a> 
<a id="21171" href="/Soundness/#20976" class="Function">nth-id-le</a> <a id="21181" href="/Soundness/#21181" class="Bound">γ-sz-δ&#39;v&#39;</a> <a id="21191" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="21193" class="Symbol">=</a> <a id="21195" href="/Denotational/#5638" class="Function">Refl⊑</a>
<a id="21201" href="/Soundness/#20976" class="Function">nth-id-le</a> <a id="21211" href="/Soundness/#21211" class="Bound">γ-sz-δ&#39;v&#39;</a> <a id="21221" class="Symbol">(</a><a id="21222" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="21224" href="/Soundness/#21224" class="Bound">n&#39;</a><a id="21226" class="Symbol">)</a> <a id="21228" class="Symbol">=</a> <a id="21230" href="/Compositional/#9007" class="Function">var-inv</a> <a id="21238" class="Symbol">(</a><a id="21239" href="/Soundness/#21211" class="Bound">γ-sz-δ&#39;v&#39;</a> <a id="21249" class="Symbol">(</a><a id="21250" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="21252" href="/Soundness/#21224" class="Bound">n&#39;</a><a id="21254" class="Symbol">))</a></pre>

<p>The above lemma proceeds by induction on <code class="highlighter-rouge">n</code>.</p>

<ul>
  <li>If it is <code class="highlighter-rouge">Z</code>, then we show that <code class="highlighter-rouge">v' ⊑ v'</code> by <code class="highlighter-rouge">Refl⊑</code>.</li>
  <li>If it is <code class="highlighter-rouge">S n'</code>, then from the premise we obtain
<code class="highlighter-rouge">γ ⊢ # n' ↓ nth n' δ'</code>. By <code class="highlighter-rouge">var-inv</code> we have
<code class="highlighter-rouge">nth n' δ' ⊑ nth n' γ</code> from which we conclude that
<code class="highlighter-rouge">nth (S n') (δ' , v') ⊑ nth (var-id (S n')) (γ , v')</code>.</li>
</ul>

<p>Returning to the proof that single substitution reflects
denotations, we have just proved that</p>

<p>(γ `, v’) ⊢ rename var-id N ↓ v</p>

<p>but we need to show <code class="highlighter-rouge">(γ </code>, v’) ⊢ N ↓ v<code class="highlighter-rouge">.
So we apply the </code>rename-id<code class="highlighter-rouge"> lemma to obtain
</code>rename var-id N ≡ N`.</p>

<p>The following is the formal version of this proof.</p>

<pre class="Agda"><a id="subst-zero-reflect"></a><a id="21886" href="/Soundness/#21886" class="Function">subst-zero-reflect</a> <a id="21905" class="Symbol">:</a> <a id="21907" class="Symbol">∀</a> <a id="21909" class="Symbol">{</a><a id="21910" href="/Soundness/#21910" class="Bound">Δ</a><a id="21911" class="Symbol">}</a> <a id="21913" class="Symbol">{</a><a id="21914" href="/Soundness/#21914" class="Bound">δ</a> <a id="21916" class="Symbol">:</a> <a id="21918" href="/Denotational/#7331" class="Function">Env</a> <a id="21922" href="/Soundness/#21910" class="Bound">Δ</a><a id="21923" class="Symbol">}</a> <a id="21925" class="Symbol">{</a><a id="21926" href="/Soundness/#21926" class="Bound">γ</a> <a id="21928" class="Symbol">:</a> <a id="21930" href="/Denotational/#7331" class="Function">Env</a> <a id="21934" class="Symbol">(</a><a id="21935" href="/Soundness/#21910" class="Bound">Δ</a> <a id="21937" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="21939" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="21940" class="Symbol">)}</a> <a id="21943" class="Symbol">{</a><a id="21944" href="/Soundness/#21944" class="Bound">M</a> <a id="21946" class="Symbol">:</a> <a id="21948" href="/Soundness/#21910" class="Bound">Δ</a> <a id="21950" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="21952" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="21953" class="Symbol">}</a>
  <a id="21957" class="Symbol">→</a> <a id="21959" href="/Soundness/#21914" class="Bound">δ</a> <a id="21961" href="/Soundness/#2986" class="Function Operator">`⊢</a> <a id="21964" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="21975" href="/Soundness/#21944" class="Bound">M</a> <a id="21977" href="/Soundness/#2986" class="Function Operator">↓</a> <a id="21979" href="/Soundness/#21926" class="Bound">γ</a>
    <a id="21985" class="Comment">----------------------------------------</a>
  <a id="22028" class="Symbol">→</a> <a id="22030" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ[</a> <a id="22033" href="/Soundness/#22033" class="Bound">w</a> <a id="22035" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">∈</a> <a id="22037" href="/Denotational/#4097" class="Datatype">Value</a> <a id="22043" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">]</a> <a id="22045" href="/Soundness/#21926" class="Bound">γ</a> <a id="22047" href="/Denotational/#8357" class="Function Operator">`⊑</a> <a id="22050" class="Symbol">(</a><a id="22051" href="/Soundness/#21914" class="Bound">δ</a> <a id="22053" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="22056" href="/Soundness/#22033" class="Bound">w</a><a id="22057" class="Symbol">)</a> <a id="22059" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">×</a> <a id="22061" href="/Soundness/#21914" class="Bound">δ</a> <a id="22063" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="22065" href="/Soundness/#21944" class="Bound">M</a> <a id="22067" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="22069" href="/Soundness/#22033" class="Bound">w</a>
<a id="22071" href="/Soundness/#21886" class="Function">subst-zero-reflect</a> <a id="22090" class="Symbol">{</a><a id="22091" class="Argument">δ</a> <a id="22093" class="Symbol">=</a> <a id="22095" href="/Soundness/#22095" class="Bound">δ</a><a id="22096" class="Symbol">}</a> <a id="22098" class="Symbol">{</a><a id="22099" class="Argument">γ</a> <a id="22101" class="Symbol">=</a> <a id="22103" href="/Soundness/#22103" class="Bound">γ</a><a id="22104" class="Symbol">}</a> <a id="22106" href="/Soundness/#22106" class="Bound">δσγ</a> <a id="22110" class="Symbol">=</a> <a id="22112" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22114" href="/Denotational/#7812" class="Function">last</a> <a id="22119" href="/Soundness/#22103" class="Bound">γ</a> <a id="22121" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22123" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22125" href="/Soundness/#22156" class="Function">lemma</a> <a id="22131" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22133" href="/Soundness/#22106" class="Bound">δσγ</a> <a id="22137" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="22139" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22141" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>   
  <a id="22148" class="Keyword">where</a>
  <a id="22156" href="/Soundness/#22156" class="Function">lemma</a> <a id="22162" class="Symbol">:</a> <a id="22164" href="/Soundness/#22103" class="Bound">γ</a> <a id="22166" href="/Denotational/#8357" class="Function Operator">`⊑</a> <a id="22169" class="Symbol">(</a><a id="22170" href="/Soundness/#22095" class="Bound">δ</a> <a id="22172" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="22175" href="/Denotational/#7812" class="Function">last</a> <a id="22180" href="/Soundness/#22103" class="Bound">γ</a><a id="22181" class="Symbol">)</a>
  <a id="22185" href="/Soundness/#22156" class="Function">lemma</a> <a id="22191" href="/Untyped/#3401" class="InductiveConstructor">Z</a>  <a id="22194" class="Symbol">=</a>  <a id="22197" href="/Denotational/#5638" class="Function">Refl⊑</a>
  <a id="22205" href="/Soundness/#22156" class="Function">lemma</a> <a id="22211" class="Symbol">(</a><a id="22212" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="22214" href="/Soundness/#22214" class="Bound">x</a><a id="22215" class="Symbol">)</a> <a id="22217" class="Symbol">=</a> <a id="22219" href="/Compositional/#9007" class="Function">var-inv</a> <a id="22227" class="Symbol">(</a><a id="22228" href="/Soundness/#22106" class="Bound">δσγ</a> <a id="22232" class="Symbol">(</a><a id="22233" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="22235" href="/Soundness/#22214" class="Bound">x</a><a id="22236" class="Symbol">))</a>
  
<a id="substitution-reflect"></a><a id="22242" href="/Soundness/#22242" class="Function">substitution-reflect</a> <a id="22263" class="Symbol">:</a> <a id="22265" class="Symbol">∀</a> <a id="22267" class="Symbol">{</a><a id="22268" href="/Soundness/#22268" class="Bound">Δ</a><a id="22269" class="Symbol">}</a> <a id="22271" class="Symbol">{</a><a id="22272" href="/Soundness/#22272" class="Bound">δ</a> <a id="22274" class="Symbol">:</a> <a id="22276" href="/Denotational/#7331" class="Function">Env</a> <a id="22280" href="/Soundness/#22268" class="Bound">Δ</a><a id="22281" class="Symbol">}</a> <a id="22283" class="Symbol">{</a><a id="22284" href="/Soundness/#22284" class="Bound">N</a> <a id="22286" class="Symbol">:</a> <a id="22288" href="/Soundness/#22268" class="Bound">Δ</a> <a id="22290" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="22292" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="22294" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="22296" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="22297" class="Symbol">}</a> <a id="22299" class="Symbol">{</a><a id="22300" href="/Soundness/#22300" class="Bound">M</a> <a id="22302" class="Symbol">:</a> <a id="22304" href="/Soundness/#22268" class="Bound">Δ</a> <a id="22306" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="22308" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="22309" class="Symbol">}</a> <a id="22311" class="Symbol">{</a><a id="22312" href="/Soundness/#22312" class="Bound">v</a><a id="22313" class="Symbol">}</a>
  <a id="22317" class="Symbol">→</a> <a id="22319" href="/Soundness/#22272" class="Bound">δ</a> <a id="22321" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="22323" href="/Soundness/#22284" class="Bound">N</a> <a id="22325" href="/Untyped/#7475" class="Function Operator">[</a> <a id="22327" href="/Soundness/#22300" class="Bound">M</a> <a id="22329" href="/Untyped/#7475" class="Function Operator">]</a> <a id="22331" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="22333" href="/Soundness/#22312" class="Bound">v</a>
    <a id="22339" class="Comment">------------------------------------------------</a>
  <a id="22390" class="Symbol">→</a> <a id="22392" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ[</a> <a id="22395" href="/Soundness/#22395" class="Bound">w</a> <a id="22397" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">∈</a> <a id="22399" href="/Denotational/#4097" class="Datatype">Value</a> <a id="22405" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">]</a> <a id="22407" href="/Soundness/#22272" class="Bound">δ</a> <a id="22409" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="22411" href="/Soundness/#22300" class="Bound">M</a> <a id="22413" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="22415" href="/Soundness/#22395" class="Bound">w</a>  <a id="22418" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">×</a>  <a id="22421" class="Symbol">(</a><a id="22422" href="/Soundness/#22272" class="Bound">δ</a> <a id="22424" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="22427" href="/Soundness/#22395" class="Bound">w</a><a id="22428" class="Symbol">)</a> <a id="22430" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="22432" href="/Soundness/#22284" class="Bound">N</a> <a id="22434" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="22436" href="/Soundness/#22312" class="Bound">v</a>
<a id="22438" href="/Soundness/#22242" class="Function">substitution-reflect</a> <a id="22459" href="/Soundness/#22459" class="Bound">d</a> <a id="22461" class="Keyword">with</a> <a id="22466" href="/Soundness/#15909" class="Function">subst-reflect</a> <a id="22480" href="/Soundness/#22459" class="Bound">d</a> <a id="22482" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="22487" class="Symbol">...</a>  <a id="22492" class="Symbol">|</a> <a id="22494" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22496" href="/Soundness/#22496" class="Bound">γ</a> <a id="22498" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22500" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22502" href="/Soundness/#22502" class="Bound">δσγ</a> <a id="22506" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22508" href="/Soundness/#22508" class="Bound">γNv</a> <a id="22512" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22514" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22516" class="Keyword">with</a> <a id="22521" href="/Soundness/#21886" class="Function">subst-zero-reflect</a> <a id="22540" href="/Soundness/#22502" class="Bound">δσγ</a>
<a id="22544" class="Symbol">...</a>    <a id="22551" class="Symbol">|</a> <a id="22553" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22555" href="/Soundness/#22555" class="Bound">w</a> <a id="22557" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22559" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22561" href="/Soundness/#22561" class="Bound">ineq</a> <a id="22566" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22568" href="/Soundness/#22568" class="Bound">δMw</a> <a id="22572" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22574" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22576" class="Symbol">=</a> <a id="22578" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22580" href="/Soundness/#22555" class="Bound">w</a> <a id="22582" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22584" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22586" href="/Soundness/#22568" class="Bound">δMw</a> <a id="22590" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22592" href="/Denotational/#26929" class="Function">Env⊑</a> <a id="22597" class="Bound">γNv</a> <a id="22601" href="/Soundness/#22561" class="Bound">ineq</a> <a id="22606" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22608" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a></pre>

<h3 id="reduction-reflects-denotations-1">Reduction reflects denotations</h3>

<p>Now that we have proved that substitution reflects denotations, we can
easily prove that reduction does too.</p>

<pre class="Agda"><a id="reflect-beta"></a><a id="22782" href="/Soundness/#22782" class="Function">reflect-beta</a> <a id="22795" class="Symbol">:</a> <a id="22797" class="Symbol">∀{</a><a id="22799" href="/Soundness/#22799" class="Bound">Γ</a><a id="22800" class="Symbol">}{</a><a id="22802" href="/Soundness/#22802" class="Bound">γ</a> <a id="22804" class="Symbol">:</a> <a id="22806" href="/Denotational/#7331" class="Function">Env</a> <a id="22810" href="/Soundness/#22799" class="Bound">Γ</a><a id="22811" class="Symbol">}{</a><a id="22813" href="/Soundness/#22813" class="Bound">M</a> <a id="22815" href="/Soundness/#22815" class="Bound">N</a><a id="22816" class="Symbol">}{</a><a id="22818" href="/Soundness/#22818" class="Bound">v</a><a id="22819" class="Symbol">}</a>
    <a id="22825" class="Symbol">→</a> <a id="22827" href="/Soundness/#22802" class="Bound">γ</a> <a id="22829" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="22831" class="Symbol">(</a><a id="22832" href="/Soundness/#22815" class="Bound">N</a> <a id="22834" href="/Untyped/#7475" class="Function Operator">[</a> <a id="22836" href="/Soundness/#22813" class="Bound">M</a> <a id="22838" href="/Untyped/#7475" class="Function Operator">]</a><a id="22839" class="Symbol">)</a> <a id="22841" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="22843" href="/Soundness/#22818" class="Bound">v</a>
    <a id="22849" class="Symbol">→</a> <a id="22851" href="/Soundness/#22802" class="Bound">γ</a> <a id="22853" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="22855" class="Symbol">(</a><a id="22856" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="22858" href="/Soundness/#22815" class="Bound">N</a><a id="22859" class="Symbol">)</a> <a id="22861" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="22863" href="/Soundness/#22813" class="Bound">M</a> <a id="22865" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="22867" href="/Soundness/#22818" class="Bound">v</a>
<a id="22869" href="/Soundness/#22782" class="Function">reflect-beta</a> <a id="22882" href="/Soundness/#22882" class="Bound">d</a> 
    <a id="22889" class="Keyword">with</a> <a id="22894" href="/Soundness/#22242" class="Function">substitution-reflect</a> <a id="22915" href="/Soundness/#22882" class="Bound">d</a>
<a id="22917" class="Symbol">...</a> <a id="22921" class="Symbol">|</a> <a id="22923" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22925" href="/Soundness/#22925" class="Bound">v₂&#39;</a> <a id="22929" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22931" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22933" href="/Soundness/#22933" class="Bound">d₁&#39;</a> <a id="22937" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22939" href="/Soundness/#22939" class="Bound">d₂&#39;</a> <a id="22943" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22945" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22947" class="Symbol">=</a> <a id="22949" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="22956" class="Symbol">(</a><a id="22957" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="22965" href="/Soundness/#22939" class="Bound">d₂&#39;</a><a id="22968" class="Symbol">)</a> <a id="22970" href="/Soundness/#22933" class="Bound">d₁&#39;</a> 


<a id="reflect"></a><a id="22977" href="/Soundness/#22977" class="Function">reflect</a> <a id="22985" class="Symbol">:</a> <a id="22987" class="Symbol">∀</a> <a id="22989" class="Symbol">{</a><a id="22990" href="/Soundness/#22990" class="Bound">Γ</a><a id="22991" class="Symbol">}</a> <a id="22993" class="Symbol">{</a><a id="22994" href="/Soundness/#22994" class="Bound">γ</a> <a id="22996" class="Symbol">:</a> <a id="22998" href="/Denotational/#7331" class="Function">Env</a> <a id="23002" href="/Soundness/#22990" class="Bound">Γ</a><a id="23003" class="Symbol">}</a> <a id="23005" class="Symbol">{</a><a id="23006" href="/Soundness/#23006" class="Bound">M</a> <a id="23008" href="/Soundness/#23008" class="Bound">M&#39;</a> <a id="23011" href="/Soundness/#23011" class="Bound">N</a> <a id="23013" href="/Soundness/#23013" class="Bound">v</a><a id="23014" class="Symbol">}</a>
  <a id="23018" class="Symbol">→</a> <a id="23020" href="/Soundness/#22994" class="Bound">γ</a> <a id="23022" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="23024" href="/Soundness/#23011" class="Bound">N</a> <a id="23026" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="23028" href="/Soundness/#23013" class="Bound">v</a>  <a id="23031" class="Symbol">→</a>  <a id="23034" href="/Soundness/#23006" class="Bound">M</a> <a id="23036" href="/Untyped/#10070" class="Datatype Operator">—→</a> <a id="23039" href="/Soundness/#23008" class="Bound">M&#39;</a>  <a id="23043" class="Symbol">→</a>   <a id="23047" href="/Soundness/#23008" class="Bound">M&#39;</a> <a id="23050" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="23052" href="/Soundness/#23011" class="Bound">N</a>
    <a id="23058" class="Comment">---------------------------------</a>
  <a id="23094" class="Symbol">→</a> <a id="23096" href="/Soundness/#22994" class="Bound">γ</a> <a id="23098" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="23100" href="/Soundness/#23006" class="Bound">M</a> <a id="23102" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="23104" href="/Soundness/#23013" class="Bound">v</a>
<a id="23106" href="/Soundness/#22977" class="Function">reflect</a> <a id="23114" href="/Denotational/#9925" class="InductiveConstructor">var</a> <a id="23118" class="Symbol">(</a><a id="23119" href="/Untyped/#10120" class="InductiveConstructor">ξ₁</a> <a id="23122" href="/Soundness/#23122" class="Bound">x₁</a> <a id="23125" href="/Soundness/#23125" class="Bound">r</a><a id="23126" class="Symbol">)</a> <a id="23128" class="Symbol">()</a>
<a id="23131" href="/Soundness/#22977" class="Function">reflect</a> <a id="23139" href="/Denotational/#9925" class="InductiveConstructor">var</a> <a id="23143" class="Symbol">(</a><a id="23144" href="/Untyped/#10230" class="InductiveConstructor">ξ₂</a> <a id="23147" href="/Soundness/#23147" class="Bound">x₁</a> <a id="23150" href="/Soundness/#23150" class="Bound">r</a><a id="23151" class="Symbol">)</a> <a id="23153" class="Symbol">()</a>
<a id="23156" href="/Soundness/#22977" class="Function">reflect</a><a id="23163" class="Symbol">{</a><a id="23164" class="Argument">γ</a> <a id="23166" class="Symbol">=</a> <a id="23168" href="/Soundness/#23168" class="Bound">γ</a><a id="23169" class="Symbol">}</a> <a id="23171" class="Symbol">(</a><a id="23172" href="/Denotational/#9925" class="InductiveConstructor">var</a><a id="23175" class="Symbol">{</a><a id="23176" class="Argument">x</a> <a id="23178" class="Symbol">=</a> <a id="23180" href="/Soundness/#23180" class="Bound">x</a><a id="23181" class="Symbol">})</a> <a id="23184" href="/Untyped/#10336" class="InductiveConstructor">β</a> <a id="23186" href="/Soundness/#23186" class="Bound">mn</a>
    <a id="23193" class="Keyword">with</a> <a id="23198" href="/Denotational/#9925" class="InductiveConstructor">var</a><a id="23201" class="Symbol">{</a><a id="23202" class="Argument">γ</a> <a id="23204" class="Symbol">=</a> <a id="23206" href="/Soundness/#23168" class="Bound">γ</a><a id="23207" class="Symbol">}{</a><a id="23209" class="Argument">x</a> <a id="23211" class="Symbol">=</a> <a id="23213" href="/Soundness/#23180" class="Bound">x</a><a id="23214" class="Symbol">}</a>
<a id="23216" class="Symbol">...</a> <a id="23220" class="Symbol">|</a> <a id="23222" href="/Soundness/#23222" class="Bound">d&#39;</a> <a id="23225" class="Keyword">rewrite</a> <a id="23233" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="23237" class="Bound">mn</a> <a id="23240" class="Symbol">=</a> <a id="23242" href="/Soundness/#22782" class="Function">reflect-beta</a> <a id="23255" href="/Soundness/#23222" class="Bound">d&#39;</a> 
<a id="23259" href="/Soundness/#22977" class="Function">reflect</a> <a id="23267" href="/Denotational/#9925" class="InductiveConstructor">var</a> <a id="23271" class="Symbol">(</a><a id="23272" href="/Untyped/#10444" class="InductiveConstructor">ζ</a> <a id="23274" href="/Soundness/#23274" class="Bound">r</a><a id="23275" class="Symbol">)</a> <a id="23277" class="Symbol">()</a>
<a id="23280" href="/Soundness/#22977" class="Function">reflect</a> <a id="23288" class="Symbol">(</a><a id="23289" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="23296" href="/Soundness/#23296" class="Bound">d₁</a> <a id="23299" href="/Soundness/#23299" class="Bound">d₂</a><a id="23301" class="Symbol">)</a> <a id="23303" class="Symbol">(</a><a id="23304" href="/Untyped/#10120" class="InductiveConstructor">ξ₁</a> <a id="23307" href="/Soundness/#23307" class="Bound">x</a> <a id="23309" href="/Soundness/#23309" class="Bound">r</a><a id="23310" class="Symbol">)</a> <a id="23312" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="23317" class="Symbol">=</a> <a id="23319" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="23326" class="Symbol">(</a><a id="23327" href="/Soundness/#22977" class="Function">reflect</a> <a id="23335" href="/Soundness/#23296" class="Bound">d₁</a> <a id="23338" href="/Soundness/#23309" class="Bound">r</a> <a id="23340" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23344" class="Symbol">)</a> <a id="23346" href="/Soundness/#23299" class="Bound">d₂</a> 
<a id="23350" href="/Soundness/#22977" class="Function">reflect</a> <a id="23358" class="Symbol">(</a><a id="23359" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="23366" href="/Soundness/#23366" class="Bound">d₁</a> <a id="23369" href="/Soundness/#23369" class="Bound">d₂</a><a id="23371" class="Symbol">)</a> <a id="23373" class="Symbol">(</a><a id="23374" href="/Untyped/#10230" class="InductiveConstructor">ξ₂</a> <a id="23377" href="/Soundness/#23377" class="Bound">x</a> <a id="23379" href="/Soundness/#23379" class="Bound">r</a><a id="23380" class="Symbol">)</a> <a id="23382" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="23387" class="Symbol">=</a> <a id="23389" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="23396" href="/Soundness/#23366" class="Bound">d₁</a> <a id="23399" class="Symbol">(</a><a id="23400" href="/Soundness/#22977" class="Function">reflect</a> <a id="23408" href="/Soundness/#23369" class="Bound">d₂</a> <a id="23411" href="/Soundness/#23379" class="Bound">r</a> <a id="23413" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23417" class="Symbol">)</a> 
<a id="23420" href="/Soundness/#22977" class="Function">reflect</a> <a id="23428" class="Symbol">(</a><a id="23429" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="23436" href="/Soundness/#23436" class="Bound">d₁</a> <a id="23439" href="/Soundness/#23439" class="Bound">d₂</a><a id="23441" class="Symbol">)</a> <a id="23443" href="/Untyped/#10336" class="InductiveConstructor">β</a> <a id="23445" href="/Soundness/#23445" class="Bound">mn</a>
    <a id="23452" class="Keyword">with</a> <a id="23457" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="23464" href="/Soundness/#23436" class="Bound">d₁</a> <a id="23467" href="/Soundness/#23439" class="Bound">d₂</a>
<a id="23470" class="Symbol">...</a> <a id="23474" class="Symbol">|</a> <a id="23476" href="/Soundness/#23476" class="Bound">d&#39;</a> <a id="23479" class="Keyword">rewrite</a> <a id="23487" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="23491" class="Bound">mn</a> <a id="23494" class="Symbol">=</a> <a id="23496" href="/Soundness/#22782" class="Function">reflect-beta</a> <a id="23509" href="/Soundness/#23476" class="Bound">d&#39;</a>
<a id="23512" href="/Soundness/#22977" class="Function">reflect</a> <a id="23520" class="Symbol">(</a><a id="23521" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="23528" href="/Soundness/#23528" class="Bound">d₁</a> <a id="23531" href="/Soundness/#23531" class="Bound">d₂</a><a id="23533" class="Symbol">)</a> <a id="23535" class="Symbol">(</a><a id="23536" href="/Untyped/#10444" class="InductiveConstructor">ζ</a> <a id="23538" href="/Soundness/#23538" class="Bound">r</a><a id="23539" class="Symbol">)</a> <a id="23541" class="Symbol">()</a>
<a id="23544" href="/Soundness/#22977" class="Function">reflect</a> <a id="23552" class="Symbol">(</a><a id="23553" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="23561" href="/Soundness/#23561" class="Bound">d</a><a id="23562" class="Symbol">)</a> <a id="23564" class="Symbol">(</a><a id="23565" href="/Untyped/#10120" class="InductiveConstructor">ξ₁</a> <a id="23568" href="/Soundness/#23568" class="Bound">x</a> <a id="23570" href="/Soundness/#23570" class="Bound">r</a><a id="23571" class="Symbol">)</a> <a id="23573" class="Symbol">()</a>
<a id="23576" href="/Soundness/#22977" class="Function">reflect</a> <a id="23584" class="Symbol">(</a><a id="23585" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="23593" href="/Soundness/#23593" class="Bound">d</a><a id="23594" class="Symbol">)</a> <a id="23596" class="Symbol">(</a><a id="23597" href="/Untyped/#10230" class="InductiveConstructor">ξ₂</a> <a id="23600" href="/Soundness/#23600" class="Bound">x</a> <a id="23602" href="/Soundness/#23602" class="Bound">r</a><a id="23603" class="Symbol">)</a> <a id="23605" class="Symbol">()</a>
<a id="23608" href="/Soundness/#22977" class="Function">reflect</a> <a id="23616" class="Symbol">(</a><a id="23617" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="23625" href="/Soundness/#23625" class="Bound">d</a><a id="23626" class="Symbol">)</a> <a id="23628" href="/Untyped/#10336" class="InductiveConstructor">β</a> <a id="23630" href="/Soundness/#23630" class="Bound">mn</a>
    <a id="23637" class="Keyword">with</a> <a id="23642" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="23650" href="/Soundness/#23625" class="Bound">d</a>
<a id="23652" class="Symbol">...</a> <a id="23656" class="Symbol">|</a> <a id="23658" href="/Soundness/#23658" class="Bound">d&#39;</a> <a id="23661" class="Keyword">rewrite</a> <a id="23669" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="23673" class="Bound">mn</a> <a id="23676" class="Symbol">=</a> <a id="23678" href="/Soundness/#22782" class="Function">reflect-beta</a> <a id="23691" href="/Soundness/#23658" class="Bound">d&#39;</a>
<a id="23694" href="/Soundness/#22977" class="Function">reflect</a> <a id="23702" class="Symbol">(</a><a id="23703" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="23711" href="/Soundness/#23711" class="Bound">d</a><a id="23712" class="Symbol">)</a> <a id="23714" class="Symbol">(</a><a id="23715" href="/Untyped/#10444" class="InductiveConstructor">ζ</a> <a id="23717" href="/Soundness/#23717" class="Bound">r</a><a id="23718" class="Symbol">)</a> <a id="23720" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="23725" class="Symbol">=</a> <a id="23727" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="23735" class="Symbol">(</a><a id="23736" href="/Soundness/#22977" class="Function">reflect</a> <a id="23744" href="/Soundness/#23711" class="Bound">d</a> <a id="23746" href="/Soundness/#23717" class="Bound">r</a> <a id="23748" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23752" class="Symbol">)</a>
<a id="23754" href="/Soundness/#22977" class="Function">reflect</a> <a id="23762" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a> <a id="23770" href="/Soundness/#23770" class="Bound">r</a> <a id="23772" href="/Soundness/#23772" class="Bound">mn</a> <a id="23775" class="Symbol">=</a> <a id="23777" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a>
<a id="23785" href="/Soundness/#22977" class="Function">reflect</a> <a id="23793" class="Symbol">(</a><a id="23794" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="23802" href="/Soundness/#23802" class="Bound">d₁</a> <a id="23805" href="/Soundness/#23805" class="Bound">d₂</a><a id="23807" class="Symbol">)</a> <a id="23809" href="/Soundness/#23809" class="Bound">r</a> <a id="23811" href="/Soundness/#23811" class="Bound">mn</a> <a id="23814" class="Keyword">rewrite</a> <a id="23822" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="23826" href="/Soundness/#23811" class="Bound">mn</a> <a id="23829" class="Symbol">=</a>
   <a id="23834" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="23842" class="Symbol">(</a><a id="23843" href="/Soundness/#22977" class="Function">reflect</a> <a id="23851" href="/Soundness/#23802" class="Bound">d₁</a> <a id="23854" href="/Soundness/#23809" class="Bound">r</a> <a id="23856" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23860" class="Symbol">)</a> <a id="23862" class="Symbol">(</a><a id="23863" href="/Soundness/#22977" class="Function">reflect</a> <a id="23871" href="/Soundness/#23805" class="Bound">d₂</a> <a id="23874" href="/Soundness/#23809" class="Bound">r</a> <a id="23876" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23880" class="Symbol">)</a>
<a id="23882" href="/Soundness/#22977" class="Function">reflect</a> <a id="23890" class="Symbol">(</a><a id="23891" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="23895" href="/Soundness/#23895" class="Bound">d</a> <a id="23897" href="/Soundness/#23897" class="Bound">lt</a><a id="23899" class="Symbol">)</a> <a id="23901" href="/Soundness/#23901" class="Bound">r</a> <a id="23903" href="/Soundness/#23903" class="Bound">mn</a> <a id="23906" class="Symbol">=</a> <a id="23908" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="23912" class="Symbol">(</a><a id="23913" href="/Soundness/#22977" class="Function">reflect</a> <a id="23921" href="/Soundness/#23895" class="Bound">d</a> <a id="23923" href="/Soundness/#23901" class="Bound">r</a> <a id="23925" href="/Soundness/#23903" class="Bound">mn</a><a id="23927" class="Symbol">)</a> <a id="23929" href="/Soundness/#23897" class="Bound">lt</a></pre>

<h2 id="reduction-implies-denotational-equality">Reduction implies denotational equality</h2>

<p>We have proved that reduction both preserves and reflects
denotations. Thus, reduction implies denotational equality.</p>

<pre class="Agda"><a id="reduce-equal"></a><a id="24121" href="/Soundness/#24121" class="Function">reduce-equal</a> <a id="24134" class="Symbol">:</a> <a id="24136" class="Symbol">∀</a> <a id="24138" class="Symbol">{</a><a id="24139" href="/Soundness/#24139" class="Bound">Γ</a><a id="24140" class="Symbol">}</a> <a id="24142" class="Symbol">{</a><a id="24143" href="/Soundness/#24143" class="Bound">M</a> <a id="24145" class="Symbol">:</a> <a id="24147" href="/Soundness/#24139" class="Bound">Γ</a> <a id="24149" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="24151" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="24152" class="Symbol">}</a> <a id="24154" class="Symbol">{</a><a id="24155" href="/Soundness/#24155" class="Bound">N</a> <a id="24157" class="Symbol">:</a> <a id="24159" href="/Soundness/#24139" class="Bound">Γ</a> <a id="24161" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="24163" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="24164" class="Symbol">}</a>
  <a id="24168" class="Symbol">→</a> <a id="24170" href="/Soundness/#24143" class="Bound">M</a> <a id="24172" href="/Untyped/#10070" class="Datatype Operator">—→</a> <a id="24175" href="/Soundness/#24155" class="Bound">N</a>
    <a id="24181" class="Comment">---------</a>
  <a id="24193" class="Symbol">→</a> <a id="24195" href="/Denotational/#18349" class="Function">ℰ</a> <a id="24197" href="/Soundness/#24143" class="Bound">M</a> <a id="24199" href="/Denotational/#18547" class="Function Operator">≃</a> <a id="24201" href="/Denotational/#18349" class="Function">ℰ</a> <a id="24203" href="/Soundness/#24155" class="Bound">N</a>
<a id="24205" href="/Soundness/#24121" class="Function">reduce-equal</a> <a id="24218" class="Symbol">{</a><a id="24219" href="/Soundness/#24219" class="Bound">Γ</a><a id="24220" class="Symbol">}{</a><a id="24222" href="/Soundness/#24222" class="Bound">M</a><a id="24223" class="Symbol">}{</a><a id="24225" href="/Soundness/#24225" class="Bound">N</a><a id="24226" class="Symbol">}</a> <a id="24228" href="/Soundness/#24228" class="Bound">r</a> <a id="24230" href="/Soundness/#24230" class="Bound">γ</a> <a id="24232" href="/Soundness/#24232" class="Bound">v</a> <a id="24234" class="Symbol">=</a>
    <a id="24240" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="24242" class="Symbol">(λ</a> <a id="24245" href="/Soundness/#24245" class="Bound">m</a> <a id="24247" class="Symbol">→</a> <a id="24249" href="/Soundness/#6495" class="Function">preserve</a> <a id="24258" href="/Soundness/#24245" class="Bound">m</a> <a id="24260" href="/Soundness/#24228" class="Bound">r</a><a id="24261" class="Symbol">)</a> <a id="24263" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="24265" class="Symbol">(λ</a> <a id="24268" href="/Soundness/#24268" class="Bound">n</a> <a id="24270" class="Symbol">→</a> <a id="24272" href="/Soundness/#22977" class="Function">reflect</a> <a id="24280" href="/Soundness/#24268" class="Bound">n</a> <a id="24282" href="/Soundness/#24228" class="Bound">r</a> <a id="24284" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="24288" class="Symbol">)</a> <a id="24290" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a></pre>

<p>We conclude with the <em>soundness property</em>, that multi-step reduction
to a lambda abstraction implies denotational equivalence with a lambda
abstraction.</p>

<pre class="Agda"><a id="soundness"></a><a id="24471" href="/Soundness/#24471" class="Function">soundness</a> <a id="24481" class="Symbol">:</a> <a id="24483" class="Symbol">∀{</a><a id="24485" href="/Soundness/#24485" class="Bound">Γ</a><a id="24486" class="Symbol">}</a> <a id="24488" class="Symbol">{</a><a id="24489" href="/Soundness/#24489" class="Bound">M</a> <a id="24491" class="Symbol">:</a> <a id="24493" href="/Soundness/#24485" class="Bound">Γ</a> <a id="24495" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="24497" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="24498" class="Symbol">}</a> <a id="24500" class="Symbol">{</a><a id="24501" href="/Soundness/#24501" class="Bound">N</a> <a id="24503" class="Symbol">:</a> <a id="24505" href="/Soundness/#24485" class="Bound">Γ</a> <a id="24507" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="24509" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="24511" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="24513" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="24514" class="Symbol">}</a>
  <a id="24518" class="Symbol">→</a> <a id="24520" href="/Soundness/#24489" class="Bound">M</a> <a id="24522" href="/Untyped/#11252" class="Datatype Operator">—↠</a> <a id="24525" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="24527" href="/Soundness/#24501" class="Bound">N</a>
    <a id="24533" class="Comment">-----------------</a>
  <a id="24553" class="Symbol">→</a> <a id="24555" href="/Denotational/#18349" class="Function">ℰ</a> <a id="24557" href="/Soundness/#24489" class="Bound">M</a> <a id="24559" href="/Denotational/#18547" class="Function Operator">≃</a> <a id="24561" href="/Denotational/#18349" class="Function">ℰ</a> <a id="24563" class="Symbol">(</a><a id="24564" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="24566" href="/Soundness/#24501" class="Bound">N</a><a id="24567" class="Symbol">)</a>
<a id="24569" href="/Soundness/#24471" class="Function">soundness</a> <a id="24579" class="Symbol">(</a><a id="24580" class="DottedPattern Symbol">.(</a><a id="24582" href="/Untyped/#4238" class="DottedPattern InductiveConstructor Operator">ƛ</a> <a id="24584" class="DottedPattern Symbol">_)</a> <a id="24587" href="/Untyped/#11302" class="InductiveConstructor Operator">∎</a><a id="24588" class="Symbol">)</a> <a id="24590" href="/Soundness/#24590" class="Bound">γ</a> <a id="24592" href="/Soundness/#24592" class="Bound">v</a> <a id="24594" class="Symbol">=</a> <a id="24596" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="24598" class="Symbol">(λ</a> <a id="24601" href="/Soundness/#24601" class="Bound">x</a> <a id="24603" class="Symbol">→</a> <a id="24605" href="/Soundness/#24601" class="Bound">x</a><a id="24606" class="Symbol">)</a> <a id="24608" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="24610" class="Symbol">(λ</a> <a id="24613" href="/Soundness/#24613" class="Bound">x</a> <a id="24615" class="Symbol">→</a> <a id="24617" href="/Soundness/#24613" class="Bound">x</a><a id="24618" class="Symbol">)</a> <a id="24620" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="24622" href="/Soundness/#24471" class="Function">soundness</a> <a id="24632" class="Symbol">{</a><a id="24633" href="/Soundness/#24633" class="Bound">Γ</a><a id="24634" class="Symbol">}</a> <a id="24636" class="Symbol">(</a><a id="24637" href="/Soundness/#24637" class="Bound">L</a> <a id="24639" href="/Untyped/#11358" class="InductiveConstructor Operator">—→⟨</a> <a id="24643" href="/Soundness/#24643" class="Bound">r</a> <a id="24645" href="/Untyped/#11358" class="InductiveConstructor Operator">⟩</a> <a id="24647" href="/Soundness/#24647" class="Bound">M—↠N</a><a id="24651" class="Symbol">)</a> <a id="24653" href="/Soundness/#24653" class="Bound">γ</a> <a id="24655" href="/Soundness/#24655" class="Bound">v</a> <a id="24657" class="Symbol">=</a>
   <a id="24662" class="Keyword">let</a> <a id="24666" href="/Soundness/#24666" class="Bound">ih</a> <a id="24669" class="Symbol">=</a> <a id="24671" href="/Soundness/#24471" class="Function">soundness</a> <a id="24681" href="/Soundness/#24647" class="Bound">M—↠N</a> <a id="24686" class="Keyword">in</a>
   <a id="24692" class="Keyword">let</a> <a id="24696" href="/Soundness/#24696" class="Bound">e</a> <a id="24698" class="Symbol">=</a> <a id="24700" href="/Soundness/#24121" class="Function">reduce-equal</a> <a id="24713" href="/Soundness/#24643" class="Bound">r</a> <a id="24715" class="Keyword">in</a>
   <a id="24721" href="/Denotational/#18968" class="Function">≃-trans</a> <a id="24729" class="Symbol">{</a><a id="24730" href="/Soundness/#24633" class="Bound">Γ</a><a id="24731" class="Symbol">}</a> <a id="24733" href="/Soundness/#24696" class="Bound">e</a> <a id="24735" href="/Soundness/#24666" class="Bound">ih</a> <a id="24738" href="/Soundness/#24653" class="Bound">γ</a> <a id="24740" href="/Soundness/#24655" class="Bound">v</a></pre>


  </div>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/Compositional/">Prev</a>
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/Soundness.lagda">Source</a>
    
    
    &bullet;
    <a alt="Next chapter" href="/Adequacy/">Next</a>
    
</p>


</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Programming Language Foundations in Agda
</h2><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Philip Wadler</li>
          <li><a class="u-email" href="mailto:wadler@inf.ed.ac.uk">wadler@inf.ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wadler"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wadler</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Wen Kokke</li>
          <li><a class="u-email" href="mailto:wen.kokke@ed.ac.uk">wen.kokke@ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wenkokke"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wenkokke</span></a></li><li><a href="https://www.twitter.com/wenkokke"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">wenkokke</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
  </div>
</footer>
<!-- Import jQuery -->
<script type="text/javascript" src="/assets/jquery.js"></script>

<!-- Script which allows for foldable code blocks -->
<script type="text/javascript">
 $('div.foldable pre').each(function(){
     var autoHeight = $(this).height();
     var lineHeight = parseFloat($(this).css('line-height'));

     var plus    = $("<div></div>");
     var horLine = $("<div></div>");
     var verLine = $("<div></div>");
     $(this).prepend(plus);
     plus.css({
         'position'         : 'relative',
         'float'            : 'right',
         'right'            : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'width'            : lineHeight,
         'height'           : lineHeight});
     verLine.css({
         'position'         : 'relative',
         'height'           : lineHeight,
         'width'            : '3px',
         'background-color' : '#C1E0FF'});
     horLine.css({
         'position'         : 'relative',
         'top'              : '-' + (0.5 * lineHeight + 1.5) + 'px',
         'left'             : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'height'           : '3px',
         'width'            : lineHeight,
         'background-color' : '#C1E0FF'});
     plus.append(verLine);
     plus.append(horLine);

     $(this).height(2.0 * lineHeight);
     $(this).css('overflow','hidden');

     $(this).click(function(){
         if ($(this).height() == autoHeight) {
             $(this).height(2.0 * lineHeight);
             plus.show();
         }
         else {
             $(this).height('auto');
             plus.hide();
         }
     });
 });
</script>

<!-- Import KaTeX -->
<script type="text/javascript" src="/assets/katex.js"></script>

<!-- Script which renders TeX using KaTeX -->
<script type="text/javascript">
 $("script[type='math/tex']").replaceWith(
     function(){
         var tex = $(this).text();
         return "<span class=\"inline-equation\">" +
                katex.renderToString(tex) +
                "</span>";
     });
 $("script[type='math/tex; mode=display']").replaceWith(
     function(){
         var tex = $(this).text().replace(/%.*?(\n|$)/g,"");
         return "<div class=\"equation\">" +
                katex.renderToString("\\displaystyle "+tex) +
                "</div>";
     });
</script>
</body>

</html>
